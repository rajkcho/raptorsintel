<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Raptors Intel | Game Day Scouting Dashboard</title>
    <meta name="description" content="Advanced Toronto Raptors game day scouting dashboard with rotation simulator, playbook analysis, injury reports, and real-time matchup intelligence." />
    <meta name="keywords" content="Toronto Raptors, NBA, scouting, analytics, game preview, rotation simulator, injury report" />
    <meta property="og:title" content="Raptors Intel | Game Day Scouting" />
    <meta property="og:description" content="The ultimate Raptors fan scouting dashboard. Deep analytics, rotation simulator, and matchup intelligence." />
    <meta property="og:type" content="website" />
    <link rel="icon" href="https://cdn.nba.com/logos/nba/1610612761/primary/L/logo.svg" type="image/svg+xml" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              raptors: {
                red: '#CE1141',
                black: '#000000',
                silver: '#A1A1A4',
                purple: '#3E2680',
              },
              cmd: {
                bg: '#0a0e17',
                surface: '#111827',
                card: '#1a1f2e',
                border: '#1e293b',
                'border-light': '#334155',
              },
              light: {
                bg: '#f8fafc',
                surface: '#ffffff',
                card: '#f1f5f9',
                border: '#e2e8f0',
                'border-light': '#cbd5e1',
              }
            },
            animation: {
              'slide-up': 'slide-up 0.6s ease-out both',
              'slide-up-1': 'slide-up 0.6s ease-out 0.15s both',
              'slide-up-2': 'slide-up 0.6s ease-out 0.3s both',
              'slide-up-3': 'slide-up 0.6s ease-out 0.45s both',
              'glow-pulse': 'glow-pulse 2s ease-in-out infinite',
              'shimmer': 'shimmer 2s linear infinite',
              'float': 'float 6s ease-in-out infinite',
              'gradient-shift': 'gradient-shift 4s ease infinite',
              'bar-grow': 'bar-grow 1s ease-out both',
              'ring-fill': 'ring-fill 1.5s ease-out both',
              'border-glow': 'border-glow 3s ease-in-out infinite',
              'text-reveal': 'text-reveal 0.8s ease-out both',
            }
          }
        }
      }
    </script>
    <style>
      body {
        background-color: #0a0e17;
        color: #e2e8f0;
      }
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: #111827;
      }
      ::-webkit-scrollbar-thumb {
        background: #334155;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #CE1141;
      }

      /* ---- Keyframe Animations ---- */
      @keyframes fade-in {
        from { opacity: 0; transform: translateY(8px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in { animation: fade-in 0.3s ease-out; }

      @keyframes slide-up {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
      }
      @keyframes glow-pulse {
        0%, 100% { box-shadow: 0 0 15px rgba(206,17,65,0.3), 0 0 30px rgba(206,17,65,0.1); }
        50% { box-shadow: 0 0 25px rgba(206,17,65,0.5), 0 0 50px rgba(206,17,65,0.2); }
      }
      @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
      }
      @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-10px) rotate(2deg); }
      }
      @keyframes gradient-shift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      @keyframes bar-grow {
        from { transform: scaleX(0); }
        to { transform: scaleX(1); }
      }
      @keyframes ring-fill {
        from { stroke-dashoffset: 283; }
      }
      @keyframes border-glow {
        0%, 100% { border-color: rgba(206,17,65,0.3); }
        50% { border-color: rgba(206,17,65,0.7); }
      }
      @keyframes text-reveal {
        from { opacity: 0; clip-path: inset(0 100% 0 0); }
        to { opacity: 1; clip-path: inset(0 0 0 0); }
      }
      @keyframes pulse-dot {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.5; transform: scale(1.5); }
      }
      @keyframes drive {
        0% { transform: translate(0, 0); }
        50% { transform: translate(10px, -15px); }
        100% { transform: translate(20px, -20px); }
      }
      @keyframes screen-anim {
        0% { transform: translate(0, 0); opacity: 0; }
        20% { opacity: 1; }
        80% { opacity: 1; }
        100% { transform: translate(5px, -5px); opacity: 0; }
      }
      @keyframes pass {
        0% { stroke-dashoffset: 100; opacity: 0; }
        20% { opacity: 1; }
        100% { stroke-dashoffset: 0; opacity: 1; }
      }
      @keyframes pulse-svg {
        0%, 100% { r: 1.5; opacity: 1; }
        50% { r: 2.5; opacity: 0.5; }
      }
      @keyframes spin-glow {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* ---- Utility Classes ---- */
      .glass-card {
        background: rgba(17, 24, 39, 0.7);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid rgba(30, 41, 59, 0.8);
        border-radius: 1rem;
      }
      .gradient-border {
        position: relative;
        border: none;
      }
      .gradient-border::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: inherit;
        padding: 1.5px;
        background: linear-gradient(135deg, #CE1141, #3E2680, #CE1141, #3E2680);
        background-size: 300% 300%;
        animation: gradient-shift 4s ease infinite;
        -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        pointer-events: none;
        z-index: 1;
      }
      .card-3d {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        transform-style: preserve-3d;
        perspective: 800px;
      }
      .card-3d:hover {
        transform: rotateX(-3deg) rotateY(3deg) translateY(-4px);
        box-shadow: 0 20px 40px rgba(206,17,65,0.15), 0 0 20px rgba(206,17,65,0.1);
      }
      .neon-text {
        text-shadow: 0 0 10px rgba(206,17,65,0.5), 0 0 20px rgba(206,17,65,0.3), 0 0 40px rgba(206,17,65,0.1);
      }
      .neon-text-subtle {
        text-shadow: 0 0 8px rgba(206,17,65,0.3), 0 0 16px rgba(206,17,65,0.1);
      }
      .hover-lift {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .hover-lift:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 24px rgba(0,0,0,0.4), 0 0 12px rgba(206,17,65,0.1);
      }
      .bg-grid {
        background-image:
          linear-gradient(rgba(206,17,65,0.03) 1px, transparent 1px),
          linear-gradient(90deg, rgba(206,17,65,0.03) 1px, transparent 1px);
        background-size: 40px 40px;
      }
      .shimmer-bg {
        background: linear-gradient(90deg, transparent, rgba(206,17,65,0.08), transparent);
        background-size: 200% 100%;
        animation: shimmer 2s linear infinite;
      }
      .btn-ripple {
        position: relative;
        overflow: hidden;
      }
      .btn-ripple::after {
        content: '';
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at var(--ripple-x, 50%) var(--ripple-y, 50%), rgba(206,17,65,0.3), transparent 70%);
        opacity: 0;
        transition: opacity 0.3s;
      }
      .btn-ripple:active::after {
        opacity: 1;
      }
      .glow-border {
        box-shadow: 0 0 15px rgba(206,17,65,0.2), inset 0 0 15px rgba(206,17,65,0.05);
      }
      .win-ring-glow {
        filter: drop-shadow(0 0 8px rgba(206,17,65,0.5));
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script src="https://cdn.jsdelivr.net/npm/react@18.3.1/umd/react.production.min.js" crossorigin></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.3.1/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.26.5/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.15.3/umd/Recharts.js"></script>
    <script>window.react = window.React;</script>
    <script src="https://cdn.jsdelivr.net/npm/lucide-react@0.460.0/dist/umd/lucide-react.min.js"></script>

    <script type="text/babel" data-type="module">
// ============================================================
// TYPES (just used as documentation, no runtime TypeScript)
// ============================================================

// ============================================================
// DATA SERVICE
// ============================================================
const fmt = (num) => Number(num.toFixed(1));

// Live NBA Scores (simulated)
const LIVE_NBA_SCORES = [
  { home: "CLE", away: "BOS", homeScore: 108, awayScore: 102, status: "Final", homeId: "1610612739", awayId: "1610612738" },
  { home: "NYK", away: "MIA", homeScore: 118, awayScore: 115, status: "Final", homeId: "1610612752", awayId: "1610612748" },
  { home: "DEN", away: "LAL", homeScore: 95, awayScore: 88, status: "Q4 5:32", homeId: "1610612743", awayId: "1610612747" },
  { home: "GSW", away: "PHX", homeScore: 72, awayScore: 68, status: "Q3 8:15", homeId: "1610612744", awayId: "1610612756" },
  { home: "MIL", away: "CHI", homeScore: 0, awayScore: 0, status: "7:30 PM", homeId: "1610612749", awayId: "1610612741" },
  { home: "DAL", away: "OKC", homeScore: 0, awayScore: 0, status: "8:00 PM", homeId: "1610612742", awayId: "1610612760" },
];

// Betting data
const BETTING_DATA = {
  spread: { line: -3.5, raptorsPct: 58, opponentPct: 42 },
  overUnder: { line: 225.5, overPct: 52, underPct: 48 },
  moneyline: { raptors: -155, opponent: +135, raptorsPct: 62, opponentPct: 38 }
};

const RAPTORS_ROSTER = [
  // --- STARTERS ---
  {
    id: "1630567", name: "Scottie Barnes", position: "PF", number: "4",
    seasonStats: { ppg: 19.4, rpg: 8.4, apg: 5.6, spg: 1.3, bpg: 1.6, oreb: 2.4, dreb: 6.0, fgPct: 50.3, threePtPct: 30.6, ftPct: 81.3, plusMinus: 3.2, turnovers: 2.7 },
    vsOpponentStats: { ppg: 21.5, rpg: 9.0, apg: 6.2, spg: 1.5, bpg: 1.8, oreb: 2.6, dreb: 6.4, fgPct: 51.0, threePtPct: 33.0, ftPct: 83.0, plusMinus: 4.0, turnovers: 2.5 },
    advanced: { per: 21.8, ts: 57.2, usg: 26.5, ortg: 116.0, drtg: 108.5 },
    last5: { ppg: 24.2, rpg: 9.8, apg: 6.5, fgPct: 54.0 }, // Hot!
    form: 'hot', // 'hot', 'cold', 'neutral'
    analysis: "The franchise cornerstone. Elite two-way force with All-NBA upside."
  },
  {
    id: "1629628", name: "RJ Barrett", position: "SF", number: "9",
    seasonStats: { ppg: 18.6, rpg: 5.2, apg: 3.5, spg: 0.8, bpg: 0.2, oreb: 1.0, dreb: 4.2, fgPct: 47.9, threePtPct: 33.8, ftPct: 70.1, plusMinus: 1.5, turnovers: 1.6 },
    vsOpponentStats: { ppg: 20.5, rpg: 5.8, apg: 4.0, spg: 1.0, bpg: 0.3, oreb: 1.1, dreb: 4.7, fgPct: 50.0, threePtPct: 36.0, ftPct: 73.0, plusMinus: 2.5, turnovers: 1.4 },
    advanced: { per: 17.5, ts: 54.8, usg: 24.0, ortg: 113.0, drtg: 112.5 },
    last5: { ppg: 16.2, rpg: 4.8, apg: 3.2, fgPct: 42.0 },
    form: 'neutral',
    analysis: "Aggressive downhill scorer with improved playmaking."
  },
  {
    id: "1630193", name: "Immanuel Quickley", position: "PG", number: "5",
    seasonStats: { ppg: 16.9, rpg: 4.5, apg: 6.1, spg: 1.3, bpg: 0.1, oreb: 0.6, dreb: 3.9, fgPct: 44.3, threePtPct: 37.9, ftPct: 80.1, plusMinus: 2.0, turnovers: 1.7 },
    vsOpponentStats: { ppg: 18.0, rpg: 5.0, apg: 7.0, spg: 1.5, bpg: 0.2, oreb: 0.7, dreb: 4.3, fgPct: 45.0, threePtPct: 39.0, ftPct: 82.0, plusMinus: 3.0, turnovers: 1.5 },
    advanced: { per: 18.2, ts: 57.5, usg: 24.5, ortg: 115.5, drtg: 111.0 },
    last5: { ppg: 21.4, rpg: 5.2, apg: 8.0, fgPct: 48.5 },
    form: 'hot',
    analysis: "Primary playmaker and floor general. Lethal three-point shooting off the dribble."
  },
  {
    id: "1627742", name: "Brandon Ingram", position: "SF", number: "3",
    seasonStats: { ppg: 21.9, rpg: 5.9, apg: 3.7, spg: 0.8, bpg: 0.8, oreb: 0.6, dreb: 5.3, fgPct: 47.0, threePtPct: 35.8, ftPct: 83.6, plusMinus: 2.8, turnovers: 2.6 },
    vsOpponentStats: { ppg: 23.5, rpg: 6.2, apg: 4.0, spg: 0.9, bpg: 0.9, oreb: 0.7, dreb: 5.5, fgPct: 48.5, threePtPct: 37.0, ftPct: 85.0, plusMinus: 3.5, turnovers: 2.3 },
    advanced: { per: 19.5, ts: 57.0, usg: 27.0, ortg: 115.0, drtg: 112.0 },
    last5: { ppg: 18.5, rpg: 5.0, apg: 3.2, fgPct: 41.0 },
    form: 'cold',
    analysis: "Leading scorer and midrange assassin."
  },
  {
    id: "1627751", name: "Jakob Poeltl", position: "C", number: "19",
    seasonStats: { ppg: 9.7, rpg: 7.7, apg: 2.1, spg: 0.8, bpg: 0.5, oreb: 2.8, dreb: 4.9, fgPct: 69.3, threePtPct: 0.0, ftPct: 59.6, plusMinus: 3.5, turnovers: 1.6 },
    vsOpponentStats: { ppg: 10.5, rpg: 8.5, apg: 2.5, spg: 0.9, bpg: 0.8, oreb: 3.2, dreb: 5.3, fgPct: 71.0, threePtPct: 0.0, ftPct: 62.0, plusMinus: 4.0, turnovers: 1.4 },
    advanced: { per: 20.5, ts: 65.0, usg: 14.5, ortg: 125.0, drtg: 107.0 },
    analysis: "Elite rim protector and screen setter."
  },
  // --- BENCH ---
  {
    id: "1630572", name: "Sandro Mamukelashvili", position: "C", number: "54",
    seasonStats: { ppg: 11.3, rpg: 5.1, apg: 2.0, spg: 0.7, bpg: 0.6, oreb: 1.5, dreb: 3.6, fgPct: 52.6, threePtPct: 37.4, ftPct: 75.5, plusMinus: 1.8, turnovers: 0.9 },
    vsOpponentStats: { ppg: 12.0, rpg: 5.5, apg: 2.2, spg: 0.8, bpg: 0.7, oreb: 1.6, dreb: 3.9, fgPct: 54.0, threePtPct: 39.0, ftPct: 77.0, plusMinus: 2.5, turnovers: 0.8 },
    advanced: { per: 17.0, ts: 60.5, usg: 17.5, ortg: 118.0, drtg: 111.0 },
    analysis: "Breakout stretch-five off the bench."
  },
  {
    id: "1642347", name: "Jamal Shead", position: "PG", number: "23",
    seasonStats: { ppg: 7.0, rpg: 1.9, apg: 5.5, spg: 1.0, bpg: 0.1, oreb: 0.3, dreb: 1.6, fgPct: 37.0, threePtPct: 33.0, ftPct: 76.7, plusMinus: 0.5, turnovers: 1.3 },
    vsOpponentStats: { ppg: 7.5, rpg: 2.2, apg: 6.0, spg: 1.2, bpg: 0.2, oreb: 0.4, dreb: 1.8, fgPct: 38.5, threePtPct: 34.0, ftPct: 78.0, plusMinus: 1.0, turnovers: 1.1 },
    advanced: { per: 12.5, ts: 50.0, usg: 16.0, ortg: 107.0, drtg: 108.5 },
    analysis: "Tenacious defensive guard."
  },
  {
    id: "1642867", name: "Collin Murray-Boyles", position: "PF", number: "12",
    seasonStats: { ppg: 7.7, rpg: 5.1, apg: 2.1, spg: 0.9, bpg: 0.8, oreb: 1.8, dreb: 3.3, fgPct: 53.4, threePtPct: 34.1, ftPct: 64.4, plusMinus: 0.8, turnovers: 1.2 },
    vsOpponentStats: { ppg: 8.5, rpg: 5.5, apg: 2.3, spg: 1.0, bpg: 0.9, oreb: 2.0, dreb: 3.5, fgPct: 55.0, threePtPct: 36.0, ftPct: 66.0, plusMinus: 1.5, turnovers: 1.0 },
    advanced: { per: 15.0, ts: 56.5, usg: 14.0, ortg: 114.0, drtg: 109.0 },
    analysis: "2025 lottery pick making an immediate impact."
  },
  {
    id: "1642266", name: "Ja'Kobe Walter", position: "SG", number: "14",
    seasonStats: { ppg: 6.2, rpg: 2.1, apg: 0.9, spg: 0.9, bpg: 0.1, oreb: 0.3, dreb: 1.8, fgPct: 42.6, threePtPct: 34.6, ftPct: 80.0, plusMinus: -0.5, turnovers: 0.5 },
    vsOpponentStats: { ppg: 7.0, rpg: 2.5, apg: 1.2, spg: 1.0, bpg: 0.2, oreb: 0.4, dreb: 2.1, fgPct: 44.0, threePtPct: 36.0, ftPct: 82.0, plusMinus: 0.0, turnovers: 0.4 },
    advanced: { per: 10.5, ts: 54.0, usg: 13.5, ortg: 109.0, drtg: 112.0 },
    analysis: "Developing two-way wing with shooting upside."
  },
  {
    id: "1641711", name: "Gradey Dick", position: "SG", number: "1",
    seasonStats: { ppg: 6.5, rpg: 2.2, apg: 0.7, spg: 0.6, bpg: 0.1, oreb: 0.3, dreb: 1.9, fgPct: 42.0, threePtPct: 31.3, ftPct: 86.2, plusMinus: -1.5, turnovers: 0.5 },
    vsOpponentStats: { ppg: 7.0, rpg: 2.5, apg: 1.0, spg: 0.7, bpg: 0.1, oreb: 0.3, dreb: 2.2, fgPct: 44.0, threePtPct: 34.0, ftPct: 88.0, plusMinus: -0.5, turnovers: 0.4 },
    advanced: { per: 9.5, ts: 53.0, usg: 12.0, ortg: 108.0, drtg: 114.0 },
    analysis: "Sharpshooting wing with deep range."
  },
  {
    id: "1631218", name: "Trayce Jackson-Davis", position: "C", number: "32",
    seasonStats: { ppg: 4.2, rpg: 3.1, apg: 0.5, spg: 0.3, bpg: 0.6, oreb: 1.2, dreb: 1.9, fgPct: 58.8, threePtPct: 0.0, ftPct: 60.0, plusMinus: -0.5, turnovers: 0.6 },
    vsOpponentStats: { ppg: 4.5, rpg: 3.5, apg: 0.6, spg: 0.3, bpg: 0.7, oreb: 1.3, dreb: 2.2, fgPct: 60.0, threePtPct: 0.0, ftPct: 62.0, plusMinus: 0.0, turnovers: 0.5 },
    advanced: { per: 12.0, ts: 58.0, usg: 10.0, ortg: 112.0, drtg: 110.0 },
    analysis: "Acquired from Warriors at trade deadline. Athletic rim-running big."
  },
  {
    id: "1642367", name: "Jonathan Mogbo", position: "PF", number: "2",
    seasonStats: { ppg: 1.4, rpg: 1.8, apg: 0.5, spg: 0.1, bpg: 0.2, oreb: 0.6, dreb: 1.2, fgPct: 50.0, threePtPct: 0.0, ftPct: 40.0, plusMinus: -1.5, turnovers: 0.3 },
    vsOpponentStats: { ppg: 1.5, rpg: 2.0, apg: 0.6, spg: 0.2, bpg: 0.3, oreb: 0.7, dreb: 1.3, fgPct: 52.0, threePtPct: 0.0, ftPct: 45.0, plusMinus: -1.0, turnovers: 0.3 },
    advanced: { per: 7.0, ts: 47.0, usg: 8.0, ortg: 98.0, drtg: 110.0 },
    analysis: "High-motor developmental forward."
  },
  {
    id: "1642419", name: "Jamison Battle", position: "SF", number: "77",
    seasonStats: { ppg: 3.3, rpg: 1.4, apg: 0.4, spg: 0.1, bpg: 0.1, oreb: 0.2, dreb: 1.2, fgPct: 53.6, threePtPct: 44.9, ftPct: 66.7, plusMinus: 0.5, turnovers: 0.4 },
    vsOpponentStats: { ppg: 3.5, rpg: 1.5, apg: 0.5, spg: 0.2, bpg: 0.1, oreb: 0.2, dreb: 1.3, fgPct: 55.0, threePtPct: 46.0, ftPct: 70.0, plusMinus: 1.0, turnovers: 0.3 },
    advanced: { per: 11.0, ts: 62.0, usg: 9.0, ortg: 120.0, drtg: 113.0 },
    analysis: "Sharpshooter off the bench."
  },
  {
    id: "202066", name: "Garrett Temple", position: "SG", number: "17",
    seasonStats: { ppg: 0.3, rpg: 0.3, apg: 0.3, spg: 0.2, bpg: 0.1, oreb: 0.1, dreb: 0.2, fgPct: 14.3, threePtPct: 20.0, ftPct: 50.0, plusMinus: -0.5, turnovers: 0.2 },
    vsOpponentStats: { ppg: 0.5, rpg: 0.5, apg: 0.3, spg: 0.2, bpg: 0.1, oreb: 0.1, dreb: 0.4, fgPct: 15.0, threePtPct: 20.0, ftPct: 50.0, plusMinus: 0.0, turnovers: 0.2 },
    advanced: { per: 3.0, ts: 30.0, usg: 5.0, ortg: 90.0, drtg: 112.0 },
    analysis: "Veteran mentor and locker room leader."
  },
  // --- TWO-WAY PLAYERS ---
  {
    id: "1630639", name: "A.J. Lawson", position: "SG", number: "0",
    seasonStats: { ppg: 2.5, rpg: 1.2, apg: 0.5, spg: 0.3, bpg: 0.1, oreb: 0.2, dreb: 1.0, fgPct: 42.0, threePtPct: 30.0, ftPct: 75.0, plusMinus: -1.0, turnovers: 0.4 },
    vsOpponentStats: { ppg: 3.0, rpg: 1.5, apg: 0.6, spg: 0.4, bpg: 0.1, oreb: 0.3, dreb: 1.2, fgPct: 44.0, threePtPct: 32.0, ftPct: 77.0, plusMinus: -0.5, turnovers: 0.3 },
    advanced: { per: 6.0, ts: 48.0, usg: 8.0, ortg: 100.0, drtg: 113.0 },
    analysis: "Athletic two-way wing shuttling between NBA and G League."
  },
  {
    id: "1642918", name: "Alijah Martin", position: "SG", number: "55",
    seasonStats: { ppg: 2.0, rpg: 1.0, apg: 0.4, spg: 0.3, bpg: 0.1, oreb: 0.1, dreb: 0.9, fgPct: 40.0, threePtPct: 28.0, ftPct: 72.0, plusMinus: -1.5, turnovers: 0.3 },
    vsOpponentStats: { ppg: 2.5, rpg: 1.2, apg: 0.5, spg: 0.3, bpg: 0.1, oreb: 0.2, dreb: 1.0, fgPct: 42.0, threePtPct: 30.0, ftPct: 74.0, plusMinus: -1.0, turnovers: 0.3 },
    advanced: { per: 5.5, ts: 46.0, usg: 7.5, ortg: 98.0, drtg: 114.0 },
    analysis: "2025 second-round pick out of Florida. Developing guard with defensive energy."
  },
  {
    id: "1642935", name: "Chucky Hepburn", position: "PG", number: "24",
    seasonStats: { ppg: 1.8, rpg: 0.8, apg: 1.2, spg: 0.2, bpg: 0.0, oreb: 0.1, dreb: 0.7, fgPct: 38.0, threePtPct: 30.0, ftPct: 78.0, plusMinus: -1.2, turnovers: 0.5 },
    vsOpponentStats: { ppg: 2.0, rpg: 1.0, apg: 1.5, spg: 0.3, bpg: 0.0, oreb: 0.1, dreb: 0.9, fgPct: 40.0, threePtPct: 32.0, ftPct: 80.0, plusMinus: -0.8, turnovers: 0.4 },
    advanced: { per: 5.0, ts: 45.0, usg: 7.0, ortg: 96.0, drtg: 115.0 },
    analysis: "Two-way point guard developing his craft in the G League."
  },
  // --- TRADE DEADLINE ACQUISITIONS ---
  {
    id: "101108", name: "Chris Paul", position: "PG", number: "3",
    seasonStats: { ppg: 2.9, rpg: 1.8, apg: 3.3, spg: 0.6, bpg: 0.0, oreb: 0.2, dreb: 1.6, fgPct: 37.5, threePtPct: 30.0, ftPct: 75.0, plusMinus: -1.5, turnovers: 1.0 },
    vsOpponentStats: { ppg: 3.2, rpg: 2.0, apg: 3.5, spg: 0.7, bpg: 0.0, oreb: 0.2, dreb: 1.8, fgPct: 39.0, threePtPct: 32.0, ftPct: 77.0, plusMinus: -1.0, turnovers: 0.9 },
    advanced: { per: 8.5, ts: 45.0, usg: 14.0, ortg: 100.0, drtg: 112.0 },
    analysis: "Acquired from Clippers at trade deadline. Future Hall of Famer providing veteran leadership."
  }
];

// Eastern Conference Standings
const STANDINGS_EAST = [
  { rank: 1, team: "Cavaliers", abbr: "CLE", id: "1610612739", wins: 42, losses: 12, gb: "-", l10: "8-2" },
  { rank: 2, team: "Celtics", abbr: "BOS", id: "1610612738", wins: 38, losses: 17, gb: "4.5", l10: "6-4" },
  { rank: 3, team: "Knicks", abbr: "NYK", id: "1610612752", wins: 36, losses: 19, gb: "6.5", l10: "7-3" },
  { rank: 4, team: "Bucks", abbr: "MIL", id: "1610612749", wins: 32, losses: 22, gb: "10", l10: "5-5" },
  { rank: 5, team: "Magic", abbr: "ORL", id: "1610612753", wins: 30, losses: 25, gb: "12.5", l10: "4-6" },
  { rank: 6, team: "Pacers", abbr: "IND", id: "1610612754", wins: 29, losses: 26, gb: "13.5", l10: "6-4" },
  { rank: 7, team: "Heat", abbr: "MIA", id: "1610612748", wins: 27, losses: 27, gb: "15", l10: "5-5" },
  { rank: 8, team: "Hawks", abbr: "ATL", id: "1610612737", wins: 26, losses: 29, gb: "16.5", l10: "4-6" },
  { rank: 9, team: "Bulls", abbr: "CHI", id: "1610612741", wins: 24, losses: 30, gb: "18", l10: "3-7" },
  { rank: 9, team: "Raptors", abbr: "TOR", id: "1610612761", wins: 25, losses: 32, gb: "17.5", l10: "8-2", highlight: true },
];

// Raptors Team Stats
const RAPTORS_STATS = { wins: 25, losses: 32, ppg: 112.5, oppPpg: 113.8, streak: "W6" };

const OPPONENT_DATA = {
  "Pistons": {
    id: "1610612765",
    roster: [
       { id: "1630595", name: "Cade Cunningham", position: "G", number: "2", seasonStats: { ppg: 24.2, rpg: 6.8, apg: 9.3 } },
       { id: "1630224", name: "Jaden Ivey", position: "G", number: "23", seasonStats: { ppg: 17.8, rpg: 3.5, apg: 4.2 } },
       { id: "1631105", name: "Jalen Duren", position: "C", number: "0", seasonStats: { ppg: 10.5, rpg: 10.8, apg: 2.1 } },
       { id: "1630527", name: "Ausar Thompson", position: "F", number: "9", seasonStats: { ppg: 8.2, rpg: 5.5, apg: 2.0 } },
       { id: "203082", name: "Tobias Harris", position: "F", number: "12", seasonStats: { ppg: 11.8, rpg: 5.2, apg: 2.5 } },
       { id: "1628381", name: "Malik Beasley", position: "G", number: "5", seasonStats: { ppg: 12.4, rpg: 2.8, apg: 1.5 } },
       { id: "1629667", name: "Tim Hardaway Jr.", position: "G", number: "10", seasonStats: { ppg: 10.5, rpg: 2.2, apg: 1.8 } },
       { id: "1631219", name: "Ron Holland", position: "F", number: "7", seasonStats: { ppg: 6.5, rpg: 3.2, apg: 1.2 } }
    ],
    tendencies: ["Young Core Development", "Transition Offense", "Rim Protection"],
    playbook: [
      { id: "p1", name: "Cade PnR", type: "offense", description: "Cunningham pick and roll.", diagramType: "pnr", execution: ["Cade initiates at top", "Duren sets screen", "Roll or pop based on coverage"], raptorsCounter: "Blitz Cunningham, rotate quick." },
      { id: "p2", name: "Ivey Push", type: "offense", description: "Transition attack.", diagramType: "iso", execution: ["Ivey gets outlet", "Pushes in transition", "Attacks before D sets"], raptorsCounter: "Get back, contain the ball." }
    ]
  },
  "Pacers": {
    id: "1610612754",
    roster: [
       { id: "1629029", name: "Tyrese Haliburton", position: "G", number: "0", seasonStats: { ppg: 18.5, rpg: 4.0, apg: 9.8 } },
       { id: "1628988", name: "Pascal Siakam", position: "F", number: "43", seasonStats: { ppg: 19.8, rpg: 7.2, apg: 3.8 } },
       { id: "1631114", name: "Bennedict Mathurin", position: "G", number: "00", seasonStats: { ppg: 16.2, rpg: 4.2, apg: 2.5 } },
       { id: "203490", name: "Myles Turner", position: "C", number: "33", seasonStats: { ppg: 15.8, rpg: 6.8, apg: 1.5, bpg: 2.2 } },
       { id: "1629303", name: "Andrew Nembhard", position: "G", number: "2", seasonStats: { ppg: 10.5, rpg: 3.2, apg: 5.5 } },
       { id: "1627763", name: "T.J. McConnell", position: "G", number: "9", seasonStats: { ppg: 8.2, rpg: 2.5, apg: 4.8 } },
       { id: "1627734", name: "Obi Toppin", position: "F", number: "1", seasonStats: { ppg: 11.5, rpg: 4.5, apg: 1.8 } },
       { id: "1629659", name: "Aaron Nesmith", position: "F", number: "23", seasonStats: { ppg: 9.8, rpg: 3.8, apg: 1.2 } }
    ],
    tendencies: ["Fast Pace", "Ball Movement", "3PT Shooting"],
    playbook: [
      { id: "p1", name: "Hali PnR", type: "offense", description: "Haliburton pick and roll action.", diagramType: "pnr", execution: ["Haliburton at top", "Turner or Siakam screens", "Lob threat or kick"], raptorsCounter: "ICE the screen, drop coverage." },
      { id: "p2", name: "Siakam Post", type: "offense", description: "Siakam post-up.", diagramType: "iso", execution: ["Entry to block", "Siakam spins baseline", "Kick to corner on double"], raptorsCounter: "Front the post, dig on catch." }
    ]
  },
  "Bulls": {
    id: "1610612741",
    roster: [
       { id: "1627853", name: "Zach LaVine", position: "G", number: "8", seasonStats: { ppg: 22.5, rpg: 4.2, apg: 4.0 } },
       { id: "1628374", name: "Coby White", position: "G", number: "0", seasonStats: { ppg: 18.5, rpg: 3.8, apg: 5.2 } },
       { id: "1630533", name: "Josh Giddey", position: "G", number: "3", seasonStats: { ppg: 12.8, rpg: 6.2, apg: 5.8 } },
       { id: "203897", name: "Nikola Vucevic", position: "C", number: "9", seasonStats: { ppg: 18.2, rpg: 10.5, apg: 3.2 } },
       { id: "1628990", name: "Patrick Williams", position: "F", number: "44", seasonStats: { ppg: 10.8, rpg: 4.5, apg: 2.2 } },
       { id: "1630173", name: "Ayo Dosunmu", position: "G", number: "12", seasonStats: { ppg: 8.5, rpg: 3.2, apg: 3.5 } },
       { id: "1631210", name: "Matas Buzelis", position: "F", number: "25", seasonStats: { ppg: 7.2, rpg: 3.8, apg: 1.5 } },
       { id: "1629655", name: "Talen Horton-Tucker", position: "G", number: "2", seasonStats: { ppg: 6.5, rpg: 2.5, apg: 2.8 } }
    ],
    tendencies: ["Mid-Range Scoring", "Vucevic Post-Ups", "Transition Attack"],
    playbook: [
      { id: "p1", name: "Vooch High-Low", type: "offense", description: "Vucevic post action.", diagramType: "horns", execution: ["Entry to Vooch at elbow", "High-low with cutter", "Face-up jumper option"], raptorsCounter: "Push Vooch off the block." },
      { id: "p2", name: "LaVine Iso", type: "offense", description: "LaVine isolation.", diagramType: "iso", execution: ["Clear side", "LaVine attacks from wing", "Step-back option"], raptorsCounter: "Force left, contest the step-back." }
    ]
  },
  "Timberwolves": {
    id: "1610612750",
    roster: [
       { id: "1630162", name: "Anthony Edwards", position: "G", number: "5", seasonStats: { ppg: 28.1, rpg: 5.8, apg: 5.2 } },
       { id: "203944", name: "Julius Randle", position: "F", number: "30", seasonStats: { ppg: 21.6, rpg: 9.4, apg: 4.8 } },
       { id: "203497", name: "Rudy Gobert", position: "C", number: "27", seasonStats: { ppg: 10.9, rpg: 12.5, apg: 1.2, bpg: 2.1 } },
       { id: "1630183", name: "Jaden McDaniels", position: "F", number: "3", seasonStats: { ppg: 10.2, rpg: 3.5, apg: 1.4 } },
       { id: "201144", name: "Mike Conley", position: "G", number: "10", seasonStats: { ppg: 8.5, rpg: 2.8, apg: 6.2 } },
       { id: "1629675", name: "Naz Reid", position: "C-F", number: "11", seasonStats: { ppg: 13.8, rpg: 5.5, apg: 1.5 } },
       { id: "1628978", name: "Donte DiVincenzo", position: "G", number: "0", seasonStats: { ppg: 9.8, rpg: 3.4, apg: 3.1 } },
       { id: "1629638", name: "Nickeil Alexander-Walker", position: "G", number: "9", seasonStats: { ppg: 9.2, rpg: 2.2, apg: 2.5 } },
       { id: "1642265", name: "Rob Dillingham", position: "G", number: "4", seasonStats: { ppg: 6.2, rpg: 1.2, apg: 2.8 } },
       { id: "1630593", name: "Joe Ingles", position: "F", number: "7", seasonStats: { ppg: 3.2, rpg: 1.5, apg: 2.1 } },
       { id: "1631168", name: "Josh Minott", position: "F", number: "8", seasonStats: { ppg: 4.5, rpg: 2.1, apg: 0.8 } },
       { id: "1630233", name: "Luka Garza", position: "C", number: "55", seasonStats: { ppg: 3.8, rpg: 2.0, apg: 0.2 } },
       { id: "1641738", name: "Terrence Shannon Jr.", position: "G", number: "00", seasonStats: { ppg: 5.1, rpg: 1.8, apg: 0.9 } },
       { id: "1631169", name: "Leonard Miller", position: "F", number: "33", seasonStats: { ppg: 3.5, rpg: 2.5, apg: 0.5 } },
       { id: "1628416", name: "PJ Dozier", position: "G-F", number: "35", seasonStats: { ppg: 4.0, rpg: 2.0, apg: 1.0 } },
       { id: "1628966", name: "Keita Bates-Diop", position: "F", number: "31", seasonStats: { ppg: 2.5, rpg: 1.5, apg: 0.5 } }
    ],
    tendencies: ["Elite Rim Protection", "Explosive Scoring", "Physical Defense"],
    playbook: [
      { id: "p1", name: "Ant Iso", type: "offense", description: "Edwards isolation from top.", diagramType: "iso", execution: ["Clear out side", "Edwards attacks downhill", "Kick out if help comes"], raptorsCounter: "Gap help, wall up at rim." },
      { id: "p2", name: "Double Drag", type: "offense", description: "Gobert/Randle screen for Ant.", diagramType: "pnr", execution: ["Conley/Ant ball handler", "Two bigs set high screens", "One rolls, one pops"], raptorsCounter: "Navigate screens, drop big." },
      { id: "p3", name: "Horns Twist", type: "offense", description: "Complex screen action for shooters.", diagramType: "horns", execution: ["Bigs at elbows", "First screen for ball", "Second screen for first big"], raptorsCounter: "Switch the twist action." },
      { id: "p4", name: "Spain PnR", type: "offense", description: "Stack pick and roll.", diagramType: "pnr", execution: ["High ball screen", "Shooter back screens the roller's man", "Shooter pops"], raptorsCounter: "Communication is key, switch low." },
      { id: "p5", name: "Exit Screen", type: "offense", description: "Corner shooter action.", diagramType: "zone", execution: ["Drive baseline", "Screen for corner man", "Drift to wing"], raptorsCounter: "Stay attached to corner." }
    ]
  },
  "Pelicans": {
    id: "1610612740",
    roster: [
       { id: "1629627", name: "Zion Williamson", position: "F", number: "1" },
       { id: "1627742", name: "Brandon Ingram", position: "F", number: "14" },
       { id: "203468", name: "CJ McCollum", position: "G", number: "3" },
       { id: "1627749", name: "Dejounte Murray", position: "G", number: "5" },
       { id: "1630529", name: "Herbert Jones", position: "F", number: "5" },
       { id: "1630530", name: "Trey Murphy III", position: "F", number: "25" },
       { id: "1630221", name: "Jose Alvarado", position: "G", number: "15" },
       { id: "1631103", name: "Yves Missi", position: "C", number: "21" }
    ],
    tendencies: ["Paint Dominance", "Length on Defense", "Mid-Range Scoring"],
    playbook: [
      { id: "p1", name: "Zion Point", type: "offense", description: "Zion initiates from top of key.", diagramType: "iso", execution: ["Zion brings ball up", "Shooters space corners", "Zion attacks downhill"], raptorsCounter: "Build a wall, force kickouts." },
      { id: "p2", name: "Elbow Split", type: "offense", description: "Ingram post action.", diagramType: "horns", execution: ["Entry to elbow", "Guard cuts off", "Hand off option"], raptorsCounter: "Deny the entry pass." }
    ]
  },
  "Celtics": {
    id: "1610612738",
    roster: [
       { id: "1628369", name: "Jayson Tatum", position: "F", number: "0" },
       { id: "1627759", name: "Jaylen Brown", position: "G-F", number: "7" },
       { id: "204001", name: "Kristaps Porzingis", position: "C-F", number: "8" },
       { id: "1628401", name: "Derrick White", position: "G", number: "9" },
       { id: "201950", name: "Jrue Holiday", position: "G", number: "4" },
       { id: "201143", name: "Al Horford", position: "C-F", number: "42" },
       { id: "1630174", name: "Payton Pritchard", position: "G", number: "11" },
       { id: "1628382", name: "Sam Hauser", position: "F", number: "30" }
    ],
    tendencies: ["High Volume 3PT", "Switch Everything Defense", "Iso-Heavy Stars"],
    playbook: [
      { id: "p1", name: "5-Out Spacing", type: "offense", description: "All 5 players on perimeter.", diagramType: "iso", execution: ["Tatum isolation top of key", "Porzingis lifts to corner", "Corners stay wide"], raptorsCounter: "Stay home on shooters, force tough 2s." },
      { id: "p2", name: "Double Drag Screen", type: "offense", description: "Two high screens for ball handler.", diagramType: "pnr", execution: ["Holiday brings ball up", "Horford and Tatum set screens", "First screener rolls, second pops"], raptorsCounter: "Ice the first screen, switch the second." },
      { id: "p3", name: "Ghost Screen", type: "offense", description: "Fake screen to pop.", diagramType: "pnr", execution: ["Guard sprints to set screen", "Slips before contact", "Flares to 3pt line"], raptorsCounter: "Switch communication." }
    ]
  },
  "Bucks": {
    id: "1610612749",
    roster: [
       { id: "203507", name: "Giannis Antetokounmpo", position: "F", number: "34", seasonStats: { ppg: 31.5, rpg: 12.0, apg: 6.2, bpg: 1.5 } },
       { id: "203114", name: "Khris Middleton", position: "F", number: "22", seasonStats: { ppg: 15.2, rpg: 4.5, apg: 4.8 } },
       { id: "201572", name: "Brook Lopez", position: "C", number: "11", seasonStats: { ppg: 11.5, rpg: 5.2, apg: 1.5, bpg: 2.5 } },
       { id: "1627739", name: "Taurean Prince", position: "F", number: "35", seasonStats: { ppg: 8.5, rpg: 3.2, apg: 1.5 } },
       { id: "1629022", name: "Gary Trent Jr.", position: "G", number: "4", seasonStats: { ppg: 13.5, rpg: 2.8, apg: 2.0 } },
       { id: "1631100", name: "AJ Green", position: "G", number: "20", seasonStats: { ppg: 8.8, rpg: 2.2, apg: 1.8 } },
       { id: "1630226", name: "Pat Connaughton", position: "G", number: "24", seasonStats: { ppg: 5.5, rpg: 3.0, apg: 1.2 } },
       { id: "1628978", name: "Bobby Portis", position: "F-C", number: "9", seasonStats: { ppg: 10.2, rpg: 7.5, apg: 1.5 } }
    ],
    tendencies: ["Giannis Drives", "Wall Defense", "Rim Protection"],
    playbook: [
      { id: "p1", name: "Giannis Freight Train", type: "offense", description: "Giannis drives from top.", diagramType: "iso", execution: ["Clear lane", "Giannis attacks rim", "Kick to shooters on help"], raptorsCounter: "Build a wall, don't reach." }
    ]
  },
  "Thunder": {
    id: "1610612760",
    roster: [
       { id: "1630532", name: "Shai Gilgeous-Alexander", position: "G", number: "2", seasonStats: { ppg: 32.8, rpg: 5.5, apg: 6.2 } },
       { id: "1630581", name: "Jalen Williams", position: "F", number: "8", seasonStats: { ppg: 21.5, rpg: 5.8, apg: 5.0 } },
       { id: "1630549", name: "Chet Holmgren", position: "C", number: "7", seasonStats: { ppg: 16.5, rpg: 8.8, apg: 2.5, bpg: 2.8 } },
       { id: "1629008", name: "Lu Dort", position: "G", number: "5", seasonStats: { ppg: 11.2, rpg: 4.2, apg: 2.0 } },
       { id: "1630537", name: "Isaiah Joe", position: "G", number: "11", seasonStats: { ppg: 9.5, rpg: 2.5, apg: 1.8 } },
       { id: "1628412", name: "Kenrich Williams", position: "F", number: "34", seasonStats: { ppg: 5.8, rpg: 4.0, apg: 2.2 } },
       { id: "1629743", name: "Isaiah Hartenstein", position: "C", number: "55", seasonStats: { ppg: 8.2, rpg: 8.5, apg: 3.0 } },
       { id: "1630585", name: "Aaron Wiggins", position: "G", number: "21", seasonStats: { ppg: 7.8, rpg: 3.2, apg: 1.5 } }
    ],
    tendencies: ["SGA Isolation", "Switchable Defense", "Length Everywhere"],
    playbook: [
      { id: "p1", name: "SGA ISO", type: "offense", description: "SGA isolation play.", diagramType: "iso", execution: ["Clear side", "SGA attacks downhill", "Mid-range or floater"], raptorsCounter: "Force tough 2s, wall up at rim." }
    ]
  },
  "Spurs": {
    id: "1610612759",
    roster: [
       { id: "1641706", name: "Victor Wembanyama", position: "C", number: "1", seasonStats: { ppg: 24.5, rpg: 10.8, apg: 4.0, bpg: 4.0 } },
       { id: "1631104", name: "Stephon Castle", position: "G", number: "5", seasonStats: { ppg: 11.5, rpg: 3.2, apg: 4.5 } },
       { id: "1628464", name: "Devin Vassell", position: "G", number: "24", seasonStats: { ppg: 16.8, rpg: 3.8, apg: 3.5 } },
       { id: "1629649", name: "Keldon Johnson", position: "F", number: "3", seasonStats: { ppg: 13.2, rpg: 5.0, apg: 2.5 } },
       { id: "1630537", name: "Jeremy Sochan", position: "F", number: "10", seasonStats: { ppg: 15.5, rpg: 7.2, apg: 4.0 } },
       { id: "201566", name: "Harrison Barnes", position: "F", number: "40", seasonStats: { ppg: 9.8, rpg: 4.5, apg: 1.5 } },
       { id: "1628499", name: "Julian Champagnie", position: "F", number: "30", seasonStats: { ppg: 7.5, rpg: 3.2, apg: 1.0 } },
       { id: "1629649", name: "Tre Jones", position: "G", number: "33", seasonStats: { ppg: 8.5, rpg: 2.5, apg: 5.2 } }
    ],
    tendencies: ["Wemby Rim Protection", "Young Core Development", "Ball Movement"],
    playbook: [
      { id: "p1", name: "Wemby Pop", type: "offense", description: "Wembanyama pick and pop.", diagramType: "pnr", execution: ["Guard initiates", "Wemby screens and pops", "3PT or drive kick"], raptorsCounter: "Contest the pop, don't leave him." }
    ]
  },
  "Wizards": {
    id: "1610612764",
    roster: [
       { id: "1630178", name: "Jordan Poole", position: "G", number: "13", seasonStats: { ppg: 17.8, rpg: 2.5, apg: 4.5 } },
       { id: "1630217", name: "Corey Kispert", position: "F", number: "24", seasonStats: { ppg: 12.5, rpg: 3.5, apg: 2.0 } },
       { id: "1629008", name: "Kyle Kuzma", position: "F", number: "33", seasonStats: { ppg: 15.5, rpg: 5.5, apg: 3.2 } },
       { id: "1631097", name: "Alexandre Sarr", position: "C", number: "20", seasonStats: { ppg: 10.5, rpg: 6.8, apg: 2.0, bpg: 1.8 } },
       { id: "1631101", name: "Bilal Coulibaly", position: "F", number: "0", seasonStats: { ppg: 10.2, rpg: 4.5, apg: 3.5 } },
       { id: "1629635", name: "Deni Avdija", position: "F", number: "8", seasonStats: { ppg: 11.8, rpg: 5.2, apg: 4.0 } },
       { id: "1630206", name: "Malcolm Brogdon", position: "G", number: "3", seasonStats: { ppg: 8.5, rpg: 2.8, apg: 3.2 } },
       { id: "1631107", name: "Johnny Davis", position: "G", number: "1", seasonStats: { ppg: 6.5, rpg: 2.5, apg: 2.0 } }
    ],
    tendencies: ["Pace and Space", "Young Development", "Transition"],
    playbook: [
      { id: "p1", name: "Poole Party", type: "offense", description: "Poole isolation.", diagramType: "iso", execution: ["Poole at top", "Step-back 3 option", "Drive and kick"], raptorsCounter: "Force him left, contest everything." }
    ]
  }
};

const GENERIC_ROSTER = [
    { id: "player1", name: "Star Point Guard", position: "G", number: "1" },
    { id: "player2", name: "Shooting Guard", position: "G", number: "2" },
    { id: "player3", name: "Small Forward", position: "F", number: "3" },
    { id: "player4", name: "Power Forward", position: "F", number: "4" },
    { id: "player5", name: "Center", position: "C", number: "5" },
    { id: "player6", name: "Sixth Man", position: "G", number: "6" },
    { id: "player7", name: "Wing Defender", position: "F", number: "7" },
    { id: "player8", name: "Backup Big", position: "C", number: "8" },
];

const generateStats = (seed, multiplier = 1) => {
    return {
        ppg: fmt((10 + Math.random() * 15) * multiplier),
        rpg: fmt((2 + Math.random() * 8) * multiplier),
        apg: fmt((1 + Math.random() * 7) * multiplier),
        spg: fmt(Math.random() * 2),
        bpg: fmt(Math.random() * 1.5),
        oreb: 1.2, dreb: 4.5,
        fgPct: fmt(45 + Math.random() * 10),
        threePtPct: fmt(32 + Math.random() * 10),
        ftPct: fmt(70 + Math.random() * 20),
        plusMinus: fmt((Math.random() * 10) - 5),
        turnovers: fmt(2.1)
    };
};

const enrichRoster = (simpleRoster) => {
    return simpleRoster.map(p => {
        const baseStats = p.seasonStats ? {
            ...generateStats(1),
            ...p.seasonStats,
            ppg: fmt(p.seasonStats.ppg || 10),
            rpg: fmt(p.seasonStats.rpg || 3),
            apg: fmt(p.seasonStats.apg || 2)
        } : generateStats(1);
        return {
            ...p,
            seasonStats: baseStats,
            vsOpponentStats: generateStats(1.1),
            advanced: {
                per: fmt(15 + Math.random() * 10),
                ts: fmt(55 + Math.random() * 10),
                usg: fmt(20 + Math.random() * 10),
                ortg: fmt(110 + Math.random() * 10),
                drtg: fmt(110 + Math.random() * 10),
            },
            analysis: "Key rotation player. Watch for aggressive drives."
        };
    });
};

const fetchRaptorsSchedule = async () => {
  const games = [
    { id: "g43", date: "Jan 16", opponent: "Clippers", opponentId: "1610612746", isHome: true, time: "7:30 PM", venue: "Scotiabank Arena", status: "completed", result: "L 117-121 OT" },
    { id: "g44", date: "Jan 18", opponent: "Lakers", opponentId: "1610612747", isHome: false, time: "10:30 PM", venue: "Crypto.com Arena", status: "completed", result: "L 93-110" },
    { id: "g45", date: "Jan 20", opponent: "Warriors", opponentId: "1610612744", isHome: false, time: "10:00 PM", venue: "Chase Center", status: "completed", result: "W 145-127" },
    { id: "g46", date: "Jan 21", opponent: "Kings", opponentId: "1610612758", isHome: false, time: "10:00 PM", venue: "Golden 1 Center", status: "completed", result: "W 122-109" },
    { id: "g47", date: "Jan 23", opponent: "Trail Blazers", opponentId: "1610612757", isHome: false, time: "10:00 PM", venue: "Moda Center", status: "completed", result: "W 110-98" },
    { id: "g48", date: "Jan 25", opponent: "Thunder", opponentId: "1610612760", isHome: false, time: "8:00 PM", venue: "Paycom Center", status: "completed", result: "W 103-101" },
    { id: "g49", date: "Jan 28", opponent: "Knicks", opponentId: "1610612752", isHome: true, time: "7:30 PM", venue: "Scotiabank Arena", status: "completed", result: "L 92-119" },
    { id: "g50", date: "Jan 30", opponent: "Magic", opponentId: "1610612753", isHome: false, time: "7:00 PM", venue: "Kia Center", status: "completed", result: "L 120-130" },
    { id: "g51", date: "Feb 1", opponent: "Jazz", opponentId: "1610612762", isHome: true, time: "7:30 PM", venue: "Scotiabank Arena", status: "completed", result: "W 107-100" },
    { id: "g52", date: "Feb 4", opponent: "Timberwolves", opponentId: "1610612750", isHome: true, time: "7:30 PM", venue: "Scotiabank Arena", status: "completed", result: "L 126-128" },
    { id: "g53", date: "Feb 5", opponent: "Bulls", opponentId: "1610612741", isHome: true, time: "7:30 PM", venue: "Scotiabank Arena", status: "completed", result: "W 130-113" },
    { id: "g54", date: "Feb 8", opponent: "Pacers", opponentId: "1610612754", isHome: true, time: "3:00 PM", venue: "Scotiabank Arena", status: "completed", result: "W 130-123" },
    { id: "g55", date: "Feb 11", opponent: "Pistons", opponentId: "1610612765", isHome: true, time: "7:30 PM", venue: "Scotiabank Arena", status: "upcoming" },
    { id: "g56", date: "Feb 19", opponent: "Bulls", opponentId: "1610612741", isHome: false, time: "8:00 PM", venue: "United Center", status: "upcoming" },
    { id: "g57", date: "Feb 22", opponent: "Bucks", opponentId: "1610612749", isHome: false, time: "3:30 PM", venue: "Fiserv Forum", status: "upcoming" },
    { id: "g58", date: "Feb 24", opponent: "Thunder", opponentId: "1610612760", isHome: true, time: "7:30 PM", venue: "Scotiabank Arena", status: "upcoming" },
    { id: "g59", date: "Feb 25", opponent: "Spurs", opponentId: "1610612759", isHome: true, time: "7:30 PM", venue: "Scotiabank Arena", status: "upcoming" },
    { id: "g60", date: "Feb 28", opponent: "Wizards", opponentId: "1610612764", isHome: false, time: "7:00 PM", venue: "Capital One Arena", status: "upcoming" },
  ];
  return { games, sources: [] };
};

const analyzeGameMatchup = async (opponent) => {
  await new Promise(resolve => setTimeout(resolve, 800));
  let opponentData = OPPONENT_DATA[opponent];
  if (!opponentData) {
      const key = Object.keys(OPPONENT_DATA).find(k => k.includes(opponent) || opponent.includes(k));
      if (key) { opponentData = OPPONENT_DATA[key]; }
      else {
          opponentData = { id: "0", roster: GENERIC_ROSTER, tendencies: ["Balanced Attack", "Man-to-Man", "Pace and Space"],
              playbook: [
                   { id: "gen1", name: "High PnR", type: "offense", description: "Standard pick and roll action.", diagramType: "pnr", execution: ["Guard calls for screen", "Big sets solid pick", "Read the defense"], raptorsCounter: "Standard drop coverage." },
                   { id: "gen2", name: "Horns", type: "offense", description: "Two bigs at the elbows.", diagramType: "horns", execution: ["Entry pass to elbow", "Corner cut", "High low action"], raptorsCounter: "Crowd the elbows." },
                   { id: "gen3", name: "Iso", type: "offense", description: "Clear out for best player.", diagramType: "iso", execution: ["1-4 flat", "Isolation at top", "Drive and kick"], raptorsCounter: "Help early." },
                   { id: "gen4", name: "Spain PnR", type: "offense", description: "Stack pick and roll.", diagramType: "pnr", execution: ["High ball screen", "Back screen for roller", "Pop"], raptorsCounter: "Switch everything." },
              ]
          };
      }
  }
  const opponentRoster = enrichRoster(opponentData.roster);
  const raptorsRoster = RAPTORS_ROSTER;
  const starPlayer = opponentRoster[0].name;
  const keyDefender = opponentRoster.length > 7 ? opponentRoster[7].name : "the bench";
  const analysis = {
    summary: `The Raptors face the ${opponent} in a crucial February matchup. With the trade deadline looming, Toronto must focus on containing ${starPlayer}. The ${opponent} have been relying on their ${opponentData.tendencies[0].toLowerCase()}, requiring disciplined rotation.`,
    winProbability: Math.floor(40 + Math.random() * 20),
    raptorsRoster, opponentRoster,
    lineupPresets: [
        { name: "Starters", description: "Main rotation", playerIds: opponentRoster.slice(0,5).map(p => p.id), netRating: 4.5, ortg: 115.2, drtg: 110.7 },
        { name: "Second Unit", description: "Bench mob", playerIds: opponentRoster.slice(5,10).map(p => p.id), netRating: -1.2, ortg: 105.0, drtg: 106.2 },
        { name: "Speed Unit", description: "Small ball lineup", playerIds: [opponentRoster[0].id, opponentRoster[4].id, opponentRoster[6]?.id, opponentRoster[7]?.id, opponentRoster[8]?.id].filter(Boolean), netRating: 2.1, ortg: 118.0, drtg: 115.9 }
    ],
    playbook: opponentData.playbook || [],
    scoutingReport: {
        offensiveTendencies: opponentData.tendencies,
        defensiveSchemes: ["Drop Coverage", "Switch 1-4", "Zone on BLOBs"],
        xFactor: opponentRoster[2].name,
        keysToVictory: [`Limit ${opponentRoster[0].name} in transition`, "Win the rebounding battle", "Generate 15+ deflections", `Force ${opponentRoster[1].name} to drive left`]
    },
    intel: {
        injuries: [
            { player: "Jakob Poeltl", status: "Out", details: "Back injury — no return timeline", team: "raptors" },
            { player: "RJ Barrett", status: "Questionable", details: "Left ankle sprain — day-to-day", team: "raptors" },
            { player: "Scottie Barnes", status: "Active", details: "Available", team: "raptors" },
            { player: "Chris Paul", status: "Active", details: "Acquired via trade — available", team: "raptors" },
            { player: "Trayce Jackson-Davis", status: "Active", details: "Acquired via trade — available", team: "raptors" },
            { player: opponentRoster[0]?.name || "Star Player", status: "Active", details: "Full go", team: "opponent" },
            { player: opponentRoster[3]?.name || "Key Forward", status: "Questionable", details: "Knee soreness — GTD", team: "opponent" }
        ],
        restDays: { raptors: 2, opponent: 1 },
        backToBack: { raptors: false, opponent: true },
        referees: [
            { name: "Scott Foster", role: "Crew Chief", foulCallRate: 45.2, tendency: "Lets them play" },
            { name: "Marc Davis", role: "Referee", foulCallRate: 42.8, tendency: "Whistle-happy in paint" },
            { name: "Courtney Kirkland", role: "Umpire", foulCallRate: 41.5, tendency: "Consistent" }
        ],
        pace: { raptors: 101.2, opponent: 98.5, leagueAvg: 99.8 },
        homeSplits: { raptors: { home: "14-12", away: "9-20" }, opponent: { home: "18-8", away: "14-14" } },
        rebounding: {
            raptors: { oreb: 10.2, dreb: 33.5, total: 43.7, orebPct: 26.8 },
            opponent: { oreb: 11.5, dreb: 34.2, total: 45.7, orebPct: 28.1 }
        },
        freeThrows: {
            raptors: { ftPct: 78.5, ftaPerGame: 21.3, ftRate: 0.268 },
            opponent: { ftPct: 76.2, ftaPerGame: 23.8, ftRate: 0.285 }
        },
        quarterScoring: {
            raptors: { q1: 27.5, q2: 28.2, q3: 26.8, q4: 29.3 },
            opponent: { q1: 28.1, q2: 27.5, q3: 28.9, q4: 27.2 }
        },
        seasonSeries: {
            raptorsWins: 1, opponentWins: 1,
            games: [
                { date: "Nov 15", result: "W 112-105", topScorer: "Scottie Barnes - 28 pts" },
                { date: "Jan 8", result: "L 98-115", topScorer: "RJ Barrett - 22 pts" }
            ]
        },
        streaks: {
            raptors: { current: "W4", home: "W2", away: "L1" },
            opponent: { current: "W2", home: "W5", away: "L2" }
        },
        assistDistribution: {
            raptors: [
                { from: "Quickley", to: "Barnes", pct: 18 },
                { from: "Quickley", to: "Ingram", pct: 15 },
                { from: "Barnes", to: "Poeltl", pct: 12 },
                { from: "Barrett", to: "Barnes", pct: 10 }
            ],
            opponent: [
                { from: "Edwards", to: "Randle", pct: 16 },
                { from: "Conley", to: "Edwards", pct: 14 },
                { from: "Conley", to: "Gobert", pct: 11 }
            ]
        },
        defenseByPosition: {
            raptors: { pg: 112.5, sg: 108.2, sf: 105.8, pf: 110.3, c: 102.4 },
            opponent: { pg: 108.1, sg: 110.5, sf: 107.2, pf: 106.8, c: 99.5 }
        },
        clutchStats: {
            raptors: { record: "8-5", ppg: 4.8, fgPct: 45.2, plusMinus: 2.1 },
            opponent: { record: "6-7", ppg: 4.2, fgPct: 41.8, plusMinus: -1.5 }
        },
        lastTenTrend: {
            raptors: [105, 112, 98, 118, 108, 115, 122, 110, 119, 114],
            opponent: [110, 102, 115, 108, 99, 112, 105, 118, 108, 111]
        },
        socialChatter: [
            { headline: "Raptors acquire Chris Paul in blockbuster 3-team deadline deal", source: "Woj (ESPN)", sentiment: "positive" },
            { headline: "Trayce Jackson-Davis traded from Warriors to Raptors for 2nd-round pick", source: "Shams (Athletic)", sentiment: "neutral" },
            { headline: "Ochai Agbaji headed to Nets as part of CP3 deal", source: "Woj (ESPN)", sentiment: "neutral" },
            { headline: "Jakob Poeltl's back injury lingers — Raptors add depth at center", source: "Raptors Republic", sentiment: "neutral" },
            { headline: `${opponent} heading to Scotiabank Arena as Raptors adjust post-deadline roster`, source: "Team Reddit", sentiment: "positive" }
        ]
    }
  };
  return { analysis, sources: [] };
};

// ============================================================
// LUCIDE ICONS - extract from global
// ============================================================
const {
  Brain, Trophy, Activity, Shield, Zap, RotateCcw, ChevronRight, LayoutTemplate,
  MessageSquare, AlertTriangle, TrendingUp, Radio, Users, Heart, Share,
  MessageCircle, MoveVertical, RefreshCcw, BarChart3, ArrowUpDown, Swords, Info,
  Calendar, LayoutDashboard, X, Target, Award, Bandage, Clock, Gavel, Home, Plane,
  ArrowRightLeft, Gauge, Timer, Sun, Moon, Bell, Download, ExternalLink, Flame,
  Snowflake, TrendingDown, Volume2, Printer, Copy, Twitter, Facebook, Send,
  ChevronUp, ChevronDown, Search, Filter, Star, Sparkles, Eye, EyeOff
} = LucideReact;

// ============================================================
// RECHARTS - extract from global
// ============================================================
const {
  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer,
  RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar,
  LineChart, Line, AreaChart, Area
} = Recharts;

const { useState, useEffect, useRef, useCallback } = React;

// ============================================================
// LIVE SCORE TICKER
// ============================================================
const LiveScoreTicker = ({ isDark = true }) => {
  const [offset, setOffset] = useState(0);
  
  useEffect(() => {
    const interval = setInterval(() => {
      setOffset(prev => (prev - 1) % -2000);
    }, 30);
    return () => clearInterval(interval);
  }, []);

  return (
    <div className={`w-full overflow-hidden ${isDark ? 'bg-cmd-bg border-cmd-border' : 'bg-light-card border-light-border'} border-b py-1.5`}>
      <div className="flex items-center gap-8 whitespace-nowrap" style={{ transform: `translateX(${offset}px)` }}>
        {[...LIVE_NBA_SCORES, ...LIVE_NBA_SCORES].map((game, i) => {
          const isLive = game.status.includes('Q');
          const isFinal = game.status === 'Final';
          return (
            <div key={i} className="flex items-center gap-3 px-4">
              <div className="flex items-center gap-2">
                <img src={`https://cdn.nba.com/logos/nba/${game.awayId}/primary/L/logo.svg`} className="w-4 h-4" alt="" />
                <span className={`text-xs font-bold ${isDark ? 'text-slate-300' : 'text-slate-700'}`}>{game.away}</span>
                <span className={`text-xs font-mono font-bold ${game.awayScore > game.homeScore ? 'text-green-500' : isDark ? 'text-white' : 'text-slate-800'}`}>{game.awayScore || '-'}</span>
              </div>
              <span className={`text-xs ${isLive ? 'text-raptors-red font-bold animate-pulse' : isFinal ? 'text-slate-500' : isDark ? 'text-slate-400' : 'text-slate-500'}`}>
                {isLive && '🔴 '}{game.status}
              </span>
              <div className="flex items-center gap-2">
                <span className={`text-xs font-mono font-bold ${game.homeScore > game.awayScore ? 'text-green-500' : isDark ? 'text-white' : 'text-slate-800'}`}>{game.homeScore || '-'}</span>
                <span className={`text-xs font-bold ${isDark ? 'text-slate-300' : 'text-slate-700'}`}>{game.home}</span>
                <img src={`https://cdn.nba.com/logos/nba/${game.homeId}/primary/L/logo.svg`} className="w-4 h-4" alt="" />
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
};

// Form Indicator Component
const FormIndicator = ({ form }) => {
  if (form === 'hot') return <span className="flex items-center gap-0.5 text-[8px] font-bold text-orange-400 bg-orange-400/10 px-1 py-0.5 rounded" title="Hot - Last 5 games above average"><Flame className="w-2.5 h-2.5" /> HOT</span>;
  if (form === 'cold') return <span className="flex items-center gap-0.5 text-[8px] font-bold text-blue-400 bg-blue-400/10 px-1 py-0.5 rounded" title="Cold - Last 5 games below average"><Snowflake className="w-2.5 h-2.5" /> COLD</span>;
  return null;
};

// Betting Trends Widget
const BettingTrendsWidget = ({ isDark = true, game }) => {
  const data = BETTING_DATA;
  return (
    <div className={`${isDark ? 'glass-card' : 'bg-white border border-light-border shadow-lg rounded-2xl'} p-4`}>
      <div className="flex items-center justify-between mb-3">
        <h3 className={`text-xs font-bold ${isDark ? 'text-white' : 'text-slate-800'} flex items-center gap-2 uppercase`}>
          <TrendingUp className="w-3 h-3 text-green-400" /> Betting Trends
        </h3>
        <span className={`text-[9px] ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>Public %</span>
      </div>
      <div className="space-y-3">
        {/* Spread */}
        <div>
          <div className="flex justify-between items-center mb-1">
            <span className={`text-[10px] ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>Spread</span>
            <span className={`text-xs font-mono font-bold ${isDark ? 'text-white' : 'text-slate-800'}`}>TOR {data.spread.line > 0 ? '+' : ''}{data.spread.line}</span>
          </div>
          <div className="flex h-3 rounded-full overflow-hidden">
            <div className="bg-raptors-red flex items-center justify-center" style={{width: `${data.spread.raptorsPct}%`}}>
              <span className="text-[8px] font-bold text-white">{data.spread.raptorsPct}%</span>
            </div>
            <div className="bg-blue-500 flex items-center justify-center" style={{width: `${data.spread.opponentPct}%`}}>
              <span className="text-[8px] font-bold text-white">{data.spread.opponentPct}%</span>
            </div>
          </div>
        </div>
        {/* Over/Under */}
        <div>
          <div className="flex justify-between items-center mb-1">
            <span className={`text-[10px] ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>Total</span>
            <span className={`text-xs font-mono font-bold ${isDark ? 'text-white' : 'text-slate-800'}`}>O/U {data.overUnder.line}</span>
          </div>
          <div className="flex h-3 rounded-full overflow-hidden">
            <div className="bg-green-500 flex items-center justify-center" style={{width: `${data.overUnder.overPct}%`}}>
              <span className="text-[8px] font-bold text-white">O {data.overUnder.overPct}%</span>
            </div>
            <div className="bg-slate-500 flex items-center justify-center" style={{width: `${data.overUnder.underPct}%`}}>
              <span className="text-[8px] font-bold text-white">U {data.overUnder.underPct}%</span>
            </div>
          </div>
        </div>
        {/* Moneyline */}
        <div>
          <div className="flex justify-between items-center mb-1">
            <span className={`text-[10px] ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>Moneyline</span>
            <div className="flex gap-2 text-xs font-mono">
              <span className="text-raptors-red font-bold">{data.moneyline.raptors}</span>
              <span className={isDark ? 'text-slate-500' : 'text-slate-400'}>|</span>
              <span className="text-blue-400 font-bold">{data.moneyline.opponent > 0 ? '+' : ''}{data.moneyline.opponent}</span>
            </div>
          </div>
          <div className="flex h-3 rounded-full overflow-hidden">
            <div className="bg-raptors-red flex items-center justify-center" style={{width: `${data.moneyline.raptorsPct}%`}}>
              <span className="text-[8px] font-bold text-white">{data.moneyline.raptorsPct}%</span>
            </div>
            <div className="bg-blue-500 flex items-center justify-center" style={{width: `${data.moneyline.opponentPct}%`}}>
              <span className="text-[8px] font-bold text-white">{data.moneyline.opponentPct}%</span>
            </div>
          </div>
        </div>
      </div>
      <div className={`mt-3 pt-2 border-t ${isDark ? 'border-cmd-border' : 'border-light-border'} text-center`}>
        <span className={`text-[9px] ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>💡 Sharp money: TOR -3.5</span>
      </div>
    </div>
  );
};

// Print/Export Report
const ExportButton = ({ game, isDark = true }) => {
  const handleExport = () => {
    // Create a print-friendly view
    const printContent = `
      RAPTORS INTEL - SCOUTING REPORT
      ================================
      
      Matchup: Toronto Raptors vs ${game?.opponent || 'TBD'}
      Date: ${game?.date || 'TBD'} | Venue: ${game?.venue || 'TBD'}
      
      Record: ${RAPTORS_STATS.wins}-${RAPTORS_STATS.losses} | Streak: ${RAPTORS_STATS.streak}
      
      Generated by Raptors Intel - https://rajkcho.github.io/raptorsintel/
    `;
    
    // Open print dialog
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
      <html>
        <head>
          <title>Raptors Intel - ${game?.opponent || 'Scouting'} Report</title>
          <style>
            body { font-family: system-ui, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
            h1 { color: #CE1141; }
            .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0; }
            .stat-box { background: #f5f5f5; padding: 15px; border-radius: 8px; text-align: center; }
            .stat-value { font-size: 24px; font-weight: bold; }
            .stat-label { font-size: 12px; color: #666; }
          </style>
        </head>
        <body>
          <h1>🦖 RAPTORS INTEL</h1>
          <h2>Scouting Report: vs ${game?.opponent || 'TBD'}</h2>
          <p><strong>Date:</strong> ${game?.date || 'TBD'} | <strong>Venue:</strong> ${game?.venue || 'TBD'}</p>
          <div class="stats">
            <div class="stat-box"><div class="stat-value">${RAPTORS_STATS.wins}-${RAPTORS_STATS.losses}</div><div class="stat-label">Record</div></div>
            <div class="stat-box"><div class="stat-value">${RAPTORS_STATS.streak}</div><div class="stat-label">Streak</div></div>
            <div class="stat-box"><div class="stat-value">${RAPTORS_STATS.ppg}</div><div class="stat-label">PPG</div></div>
          </div>
          <hr>
          <p style="color: #666; font-size: 12px;">Generated by Raptors Intel • Not affiliated with NBA or Toronto Raptors</p>
        </body>
      </html>
    `);
    printWindow.document.close();
    printWindow.print();
  };

  return (
    <button onClick={handleExport} className={`p-2 rounded-lg transition-all ${isDark ? 'hover:bg-cmd-card text-slate-400 hover:text-white' : 'hover:bg-light-card text-slate-500 hover:text-slate-800'}`} title="Export Report">
      <Printer className="w-4 h-4" />
    </button>
  );
};

// ============================================================
// COUNTDOWN TIMER
// ============================================================
const GameCountdown = ({ game, isDark = true }) => {
  const [timeLeft, setTimeLeft] = useState({ days: 0, hours: 0, mins: 0, secs: 0 });
  
  useEffect(() => {
    if (!game || game.status !== 'upcoming') return;
    
    const calculateTime = () => {
      const gameDate = new Date(`${game.date} 2026 ${game.time} EST`);
      const now = new Date();
      const diff = gameDate - now;
      
      if (diff <= 0) {
        setTimeLeft({ days: 0, hours: 0, mins: 0, secs: 0 });
        return;
      }
      
      setTimeLeft({
        days: Math.floor(diff / (1000 * 60 * 60 * 24)),
        hours: Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)),
        mins: Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60)),
        secs: Math.floor((diff % (1000 * 60)) / 1000)
      });
    };
    
    calculateTime();
    const interval = setInterval(calculateTime, 1000);
    return () => clearInterval(interval);
  }, [game]);

  if (!game || game.status !== 'upcoming') return null;

  const TimeBox = ({ value, label }) => (
    <div className={`text-center px-2 py-1 ${isDark ? 'bg-cmd-bg' : 'bg-light-card'} rounded-lg`}>
      <div className={`text-lg font-mono font-black ${isDark ? 'text-white' : 'text-slate-800'}`}>{String(value).padStart(2, '0')}</div>
      <div className={`text-[8px] uppercase font-bold ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>{label}</div>
    </div>
  );

  return (
    <div className={`${isDark ? 'glass-card' : 'bg-white border border-light-border shadow-lg rounded-2xl'} p-4`}>
      <div className="flex items-center justify-between mb-3">
        <h3 className={`text-xs font-bold ${isDark ? 'text-white' : 'text-slate-800'} flex items-center gap-2 uppercase`}>
          <Clock className="w-3 h-3 text-raptors-red" /> Time to Tip-Off
        </h3>
      </div>
      <div className="flex justify-center gap-2">
        {timeLeft.days > 0 && <TimeBox value={timeLeft.days} label="Days" />}
        <TimeBox value={timeLeft.hours} label="Hrs" />
        <TimeBox value={timeLeft.mins} label="Min" />
        <TimeBox value={timeLeft.secs} label="Sec" />
      </div>
      <div className={`text-center mt-2 text-[10px] ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>
        {game.date} • {game.time}
      </div>
    </div>
  );
};

// Win Streak Celebration
const StreakCelebration = ({ streak, isDark = true }) => {
  if (!streak || !streak.startsWith('W')) return null;
  const wins = parseInt(streak.slice(1)) || 0;
  if (wins < 3) return null;
  
  return (
    <div className={`${isDark ? 'glass-card' : 'bg-white border border-light-border shadow-lg rounded-2xl'} p-4 relative overflow-hidden`}>
      <div className="absolute inset-0 bg-gradient-to-r from-green-500/10 via-transparent to-green-500/10 animate-pulse"></div>
      <div className="relative z-10 text-center">
        <div className="text-3xl mb-1">🔥</div>
        <div className={`text-2xl font-black ${isDark ? 'text-white' : 'text-slate-800'}`}>{wins} GAME WIN STREAK!</div>
        <div className={`text-xs ${isDark ? 'text-green-400' : 'text-green-600'} font-bold uppercase mt-1`}>Raptors are rolling!</div>
        <div className="flex justify-center gap-1 mt-2">
          {[...Array(Math.min(wins, 10))].map((_, i) => (
            <span key={i} className="text-green-500 text-sm" style={{animationDelay: `${i * 0.1}s`, animation: 'bounce 0.5s ease-in-out infinite'}}>✓</span>
          ))}
        </div>
      </div>
    </div>
  );
};

// Quick Stats Bar
const QuickStatsBar = ({ isDark = true }) => {
  const stats = [
    { label: 'PPG', value: RAPTORS_STATS.ppg, rank: '#12' },
    { label: 'OPP PPG', value: RAPTORS_STATS.oppPpg, rank: '#22' },
    { label: 'DIFF', value: (RAPTORS_STATS.ppg - RAPTORS_STATS.oppPpg).toFixed(1), isNeg: RAPTORS_STATS.ppg < RAPTORS_STATS.oppPpg },
  ];
  
  return (
    <div className={`${isDark ? 'glass-card' : 'bg-white border border-light-border shadow-lg rounded-2xl'} p-3`}>
      <div className="flex items-center justify-between">
        {stats.map((stat, i) => (
          <div key={i} className="text-center flex-1">
            <div className={`text-lg font-mono font-black ${stat.isNeg ? 'text-red-400' : isDark ? 'text-white' : 'text-slate-800'}`}>
              {stat.isNeg ? '' : stat.value > 0 && i === 2 ? '+' : ''}{stat.value}
            </div>
            <div className={`text-[9px] uppercase font-bold ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>{stat.label}</div>
          </div>
        ))}
      </div>
    </div>
  );
};

// ============================================================
// MICRO-COMPONENTS
// ============================================================
const AnimatedCounter = ({ value, decimals = 1, duration = 1200, prefix = '', suffix = '' }) => {
  const [display, setDisplay] = useState(0);
  const ref = useRef(null);
  useEffect(() => {
    const target = Number(value) || 0;
    let start = null;
    const step = (ts) => {
      if (!start) start = ts;
      const progress = Math.min((ts - start) / duration, 1);
      const eased = 1 - Math.pow(1 - progress, 3);
      setDisplay(eased * target);
      if (progress < 1) ref.current = requestAnimationFrame(step);
    };
    ref.current = requestAnimationFrame(step);
    return () => cancelAnimationFrame(ref.current);
  }, [value, duration]);
  return React.createElement('span', null, prefix + display.toFixed(decimals) + suffix);
};

const WinProbRing = ({ value, size = 100 }) => {
  const r = 40;
  const circ = 2 * Math.PI * r;
  const offset = circ - (circ * (value || 0)) / 100;
  return (
    <div className="relative win-ring-glow" style={{ width: size, height: size }}>
      <svg viewBox="0 0 100 100" className="w-full h-full -rotate-90">
        <circle cx="50" cy="50" r={r} fill="none" stroke="rgba(206,17,65,0.15)" strokeWidth="6" />
        <circle cx="50" cy="50" r={r} fill="none" stroke="url(#ringGrad)" strokeWidth="6" strokeLinecap="round" strokeDasharray={circ} strokeDashoffset={offset} className="animate-ring-fill" style={{ animation: 'ring-fill 1.5s ease-out both' }} />
        <defs>
          <linearGradient id="ringGrad" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stopColor="#CE1141" />
            <stop offset="100%" stopColor="#3E2680" />
          </linearGradient>
        </defs>
      </svg>
      <div className="absolute inset-0 flex flex-col items-center justify-center">
        <div className="text-2xl font-black text-white neon-text"><AnimatedCounter value={value} decimals={0} suffix="%" /></div>
        <div className="text-[8px] uppercase font-bold text-slate-400 tracking-wider">Win Prob</div>
      </div>
    </div>
  );
};

const GlowDivider = () => (
  <div className="h-px w-full bg-gradient-to-r from-transparent via-raptors-red/40 to-transparent my-2"></div>
);

// ============================================================
// COURT DIAGRAM
// ============================================================
const getDiagram = (type) => {
    switch(type) {
        case 'pnr':
            return (
                <g>
                   <circle cx="50" cy="50" r="1.5" fill="#CE1141" style={{animation: 'drive 3s infinite'}} />
                   <path d="M50 50 Q 60 40 70 30" fill="none" stroke="#CE1141" strokeWidth="0.5" markerEnd="url(#arrowhead)" strokeDasharray="2,1" opacity="0.5" />
                   <circle cx="55" cy="45" r="1.5" fill="#94a3b8" style={{animation: 'screen-anim 3s infinite 1s'}} />
                   <line x1="55" y1="45" x2="60" y2="40" stroke="#94a3b8" strokeWidth="1" strokeLinecap="round" opacity="0.5" />
                   <text x="45" y="55" fontSize="2" fill="#94a3b8">PG</text>
                   <text x="52" y="44" fontSize="2" fill="#94a3b8">C</text>
                </g>
            );
        case 'horns':
             return (
                <g>
                    <circle cx="70" cy="20" r="1.5" fill="#94a3b8" />
                    <circle cx="70" cy="40" r="1.5" fill="#94a3b8" />
                    <circle cx="60" cy="30" r="1.5" fill="#CE1141" />
                    <path d="M60 30 L 70 20" fill="none" stroke="#CE1141" strokeWidth="0.5" strokeDasharray="1,1" style={{animation: 'pass 2s infinite'}} />
                    <path d="M60 30 L 70 40" fill="none" stroke="#CE1141" strokeWidth="0.5" strokeDasharray="1,1" style={{animation: 'pass 2s infinite 1s'}} />
                </g>
             );
        case 'zone':
             return (
                <g>
                    <circle cx="75" cy="20" r="1.5" fill="#6366f1" opacity="0.7" style={{animation: 'pulse-svg 2s infinite'}} />
                    <circle cx="75" cy="40" r="1.5" fill="#6366f1" opacity="0.7" style={{animation: 'pulse-svg 2s infinite 0.5s'}} />
                    <circle cx="85" cy="15" r="1.5" fill="#6366f1" opacity="0.7" style={{animation: 'pulse-svg 2s infinite 1s'}} />
                    <circle cx="85" cy="30" r="1.5" fill="#6366f1" opacity="0.7" style={{animation: 'pulse-svg 2s infinite 1.5s'}} />
                    <circle cx="85" cy="45" r="1.5" fill="#6366f1" opacity="0.7" style={{animation: 'pulse-svg 2s infinite 2s'}} />
                </g>
             );
        default:
            return (
                <g>
                    <path d="M60 10 Q 75 30 85 30" fill="none" stroke="#CE1141" strokeWidth="0.8" markerEnd="url(#arrowhead)" strokeDasharray="2,1" style={{animation: 'pass 3s infinite'}} />
                    <circle cx="60" cy="10" r="1.5" fill="#CE1141" style={{animation: 'pulse-svg 1s infinite'}} />
                    <text x="55" y="10" fontSize="3" fill="#94a3b8">ISO</text>
                </g>
            );
    }
};

const PlayOverlay = ({ play }) => (
    <g key={play.id}>
        <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
              <polygon points="0 0, 10 3.5, 0 7" fill="#CE1141" />
            </marker>
        </defs>
        {getDiagram(play.diagramType)}
    </g>
);

const CourtDiagram = ({ play }) => (
    <div className="relative w-full pt-[60%] bg-[#0f1520] rounded-xl overflow-hidden border border-cmd-border shadow-lg">
      <div className="absolute inset-0">
          <svg viewBox="0 0 100 60" className="w-full h-full" preserveAspectRatio="none">
             <rect x="0" y="0" width="100" height="60" fill="#0f1520" />
             <rect x="0" y="22" width="12" height="16" fill="#CE1141" fillOpacity="0.08" />
             <rect x="88" y="22" width="12" height="16" fill="#3E2680" fillOpacity="0.08" />
             <circle cx="50" cy="30" r="8" fill="none" stroke="rgba(206,17,65,0.25)" strokeWidth="0.5" />
             <path d="M50 0 V60" stroke="rgba(206,17,65,0.15)" strokeWidth="0.2" />
             <rect x="0" y="22" width="12" height="16" fill="none" stroke="rgba(206,17,65,0.4)" strokeWidth="0.5" />
             <circle cx="12" cy="30" r="4" fill="none" stroke="rgba(206,17,65,0.4)" strokeWidth="0.5" />
             <path d="M0 10 A 15 15 0 0 1 15 50" fill="none" stroke="rgba(206,17,65,0.2)" strokeWidth="0.5" strokeDasharray="1,1" />
             <rect x="88" y="22" width="12" height="16" fill="none" stroke="rgba(62,38,128,0.4)" strokeWidth="0.5" />
             <circle cx="88" cy="30" r="4" fill="none" stroke="rgba(62,38,128,0.4)" strokeWidth="0.5" />
             {play && <PlayOverlay play={play} />}
          </svg>
      </div>
      <div className="absolute top-2 left-2 bg-cmd-surface/90 backdrop-blur text-slate-300 border border-cmd-border px-3 py-1 rounded text-[10px] font-mono font-bold uppercase z-10">
         {play ? play.name : 'Tactical Board'}
      </div>
    </div>
);

// ============================================================
// PLAYER DEEP DIVE
// ============================================================
const StatBox = ({ label, value, sub, color }) => (
    <div className="bg-cmd-bg/50 p-3 rounded-lg border border-cmd-border hover:border-raptors-red/30 hover:shadow-lg hover:shadow-raptors-red/5 transition-all">
        <div className="text-[10px] text-slate-500 uppercase font-bold">{label}</div>
        <div className={`text-xl font-mono font-bold ${color || 'text-white'}`}>{value !== undefined ? <AnimatedCounter value={Number(String(value).replace('%','')) || 0} decimals={1} suffix={String(value).includes('%') ? '%' : ''} /> : '-'}</div>
        {sub && <div className="text-[10px] text-slate-500 mt-1">{sub}</div>}
    </div>
);

const PlayerDeepDive = ({ player, opponentName, onClose }) => {
  const s = player.seasonStats || {};
  const v = player.vsOpponentStats || {};
  const a = player.advanced || {};
  const radarData = [
    { subject: 'PTS', A: s.ppg || 0, fullMark: 30 },
    { subject: 'REB', A: s.rpg || 0, fullMark: 15 },
    { subject: 'AST', A: s.apg || 0, fullMark: 12 },
    { subject: 'PER', A: a.per || 0, fullMark: 30 },
    { subject: 'USG', A: a.usg || 0, fullMark: 40 },
    { subject: 'TS%', A: (a.ts || 0), fullMark: 100 },
  ];
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-fade-in">
      <div className="bg-cmd-surface w-full max-w-5xl rounded-3xl overflow-hidden border border-raptors-red/20 shadow-2xl shadow-raptors-red/10 flex flex-col max-h-[90vh]">
        <div className="relative h-48 bg-cmd-bg overflow-hidden flex-shrink-0">
             <div className="absolute inset-0 bg-gradient-to-r from-cmd-bg via-cmd-surface to-raptors-red/20"></div>
             <img src={`https://cdn.nba.com/headshots/nba/latest/1040x760/${player.id}.png`} className="absolute bottom-0 right-10 h-[120%] object-contain" style={{filter: 'drop-shadow(0 0 20px rgba(206,17,65,0.4))'}} alt={player.name} />
             <div className="absolute top-0 left-0 p-8">
                 <button onClick={onClose} className="mb-4 text-slate-500 hover:text-raptors-red flex items-center gap-2 transition-colors"><X className="w-5 h-5" /> Close Scouting Report</button>
                 <h2 className="text-5xl font-black text-white uppercase italic tracking-tighter neon-text">{player.name}</h2>
                 <div className="flex gap-4 mt-2 text-xl font-mono text-slate-400"><span>#{player.number}</span><span>|</span><span>{player.position}</span></div>
             </div>
        </div>
        <div className="p-8 overflow-y-auto custom-scrollbar">
           <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
               <div className="space-y-6">
                   <h3 className="flex items-center gap-2 text-raptors-red font-bold uppercase tracking-widest border-b border-cmd-border pb-2"><Activity className="w-4 h-4" /> Season Averages</h3>
                   <div className="grid grid-cols-2 gap-4">
                       <StatBox label="PPG" value={s.ppg} />
                       <StatBox label="RPG" value={s.rpg} sub={`${s.oreb || 0} Off / ${s.dreb || 0} Def`} />
                       <StatBox label="APG" value={s.apg} />
                       <StatBox label="+/-" value={s.plusMinus} color={s.plusMinus > 0 ? 'text-green-400' : 'text-red-400'} />
                       <StatBox label="FG%" value={`${s.fgPct}%`} />
                       <StatBox label="3P%" value={`${s.threePtPct}%`} />
                   </div>
                   <div className="bg-cmd-bg/50 p-4 rounded-xl border border-cmd-border">
                       <div className="text-xs text-slate-500 uppercase mb-2 font-bold">Efficiency Metrics</div>
                       <div className="flex justify-between items-center text-sm mb-1"><span className="text-slate-400">PER</span><span className="font-bold text-white">{a.per}</span></div>
                       <div className="w-full bg-cmd-border h-1.5 rounded-full overflow-hidden"><div className="bg-raptors-red h-full rounded-full shadow-lg shadow-raptors-red/30" style={{width: `${(a.per/35)*100}%`, animation: 'bar-grow 1s ease-out both', transformOrigin: 'left'}}></div></div>
                       <div className="flex justify-between items-center text-sm mt-3 mb-1"><span className="text-slate-400">True Shooting</span><span className="font-bold text-white">{a.ts}%</span></div>
                       <div className="w-full bg-cmd-border h-1.5 rounded-full overflow-hidden"><div className="bg-blue-500 h-full rounded-full shadow-lg shadow-blue-500/30" style={{width: `${a.ts}%`, animation: 'bar-grow 1s ease-out 0.2s both', transformOrigin: 'left'}}></div></div>
                   </div>
               </div>
               <div className="space-y-6">
                   <h3 className="flex items-center gap-2 text-blue-400 font-bold uppercase tracking-widest border-b border-cmd-border pb-2"><Target className="w-4 h-4" /> VS {opponentName}</h3>
                   <div className="bg-blue-500/5 border border-blue-500/20 p-6 rounded-2xl">
                       <div className="text-center mb-6"><div className="text-4xl font-black text-white mb-1 neon-text-subtle">{v.ppg || '-'}</div><div className="text-xs text-blue-400 uppercase font-bold">Points vs {opponentName}</div></div>
                       <div className="space-y-4">
                           <div className="flex justify-between items-center p-3 bg-cmd-bg/50 rounded-lg border border-cmd-border"><span className="text-slate-400 text-sm font-medium">Rebounds</span><span className="font-mono font-bold text-white">{v.rpg || '-'}</span></div>
                           <div className="flex justify-between items-center p-3 bg-cmd-bg/50 rounded-lg border border-cmd-border"><span className="text-slate-400 text-sm font-medium">Assists</span><span className="font-mono font-bold text-white">{v.apg || '-'}</span></div>
                           <div className="flex justify-between items-center p-3 bg-cmd-bg/50 rounded-lg border border-cmd-border"><span className="text-slate-400 text-sm font-medium">Turnovers</span><span className="font-mono font-bold text-white">{v.turnovers || '-'}</span></div>
                       </div>
                   </div>
                   <div className="bg-cmd-bg/50 p-4 rounded-xl border border-cmd-border"><p className="text-sm text-slate-400 italic leading-relaxed">"{player.analysis || `Key player for the rotation against ${opponentName}.`}"</p></div>
               </div>
               <div className="space-y-6">
                   <h3 className="flex items-center gap-2 text-white font-bold uppercase tracking-widest border-b border-cmd-border pb-2"><TrendingUp className="w-4 h-4" /> Impact Profile</h3>
                   <div className="h-64 w-full">
                       <ResponsiveContainer width="100%" height="100%">
                           <RadarChart cx="50%" cy="50%" outerRadius="80%" data={radarData}>
                               <PolarGrid stroke="#1e293b" />
                               <PolarAngleAxis dataKey="subject" tick={{ fill: '#94a3b8', fontSize: 10, fontWeight: 'bold' }} />
                               <PolarRadiusAxis angle={30} domain={[0, 'auto']} tick={false} axisLine={false} />
                               <Radar name={player.name} dataKey="A" stroke="#3E2680" fill="#CE1141" fillOpacity={0.5} />
                               <Tooltip contentStyle={{ backgroundColor: '#111827', borderColor: '#1e293b', borderRadius: '8px', boxShadow: '0 4px 20px rgba(206,17,65,0.2)', color: '#e2e8f0' }} itemStyle={{ color: '#e2e8f0', fontWeight: 'bold' }} />
                           </RadarChart>
                       </ResponsiveContainer>
                   </div>
               </div>
           </div>
        </div>
      </div>
    </div>
  );
};

// ============================================================
// SCHEDULE LIST
// ============================================================
const ScheduleList = ({ games, onSelectGame, selectedGameId, isDark = true }) => {
  const [filter, setFilter] = useState('all'); // 'all', 'home', 'away', 'upcoming'
  
  const formatDate = (dateStr) => {
    try { const d = new Date(dateStr); if (!isNaN(d.getTime())) return { month: d.toLocaleString('en-US', { month: 'short' }).toUpperCase(), day: d.getDate().toString() }; } catch(e) {}
    const parts = dateStr.trim().split(' ');
    if (parts.length >= 2) return { month: parts[0].slice(0, 3).toUpperCase(), day: parts[1].replace(/[^0-9]/g, '') || '?' };
    return { month: 'GAME', day: '' };
  };

  const filteredGames = games.filter(g => {
    if (filter === 'home') return g.isHome;
    if (filter === 'away') return !g.isHome;
    if (filter === 'upcoming') return g.status === 'upcoming';
    return true;
  });

  return (
    <div className={`${isDark ? 'glass-card' : 'bg-white border border-light-border shadow-lg rounded-2xl'} overflow-hidden flex flex-col`} style={{maxHeight: '400px'}}>
      <div className={`p-3 border-b ${isDark ? 'border-cmd-border' : 'border-light-border'} bg-gradient-to-r from-raptors-red/10 to-transparent sticky top-0 z-10`}>
        <h2 className={`text-sm font-bold ${isDark ? 'text-slate-200' : 'text-slate-800'} flex items-center gap-2 uppercase tracking-tight mb-2`}><Calendar className="text-raptors-red w-4 h-4" /> 25-26 Schedule</h2>
        <div className="flex gap-1">
          {[
            { key: 'all', label: 'All' },
            { key: 'upcoming', label: 'Next' },
            { key: 'home', label: 'Home' },
            { key: 'away', label: 'Away' },
          ].map(f => (
            <button
              key={f.key}
              onClick={() => setFilter(f.key)}
              className={`flex-1 text-[9px] py-1 rounded font-bold transition-all ${filter === f.key 
                ? 'bg-raptors-red text-white' 
                : isDark ? 'bg-cmd-bg text-slate-400 hover:text-white' : 'bg-light-card text-slate-500 hover:text-slate-800'}`}
            >
              {f.label}
            </button>
          ))}
        </div>
      </div>
      <div className={`overflow-y-auto flex-1 divide-y ${isDark ? 'divide-cmd-border' : 'divide-light-border'}`}>
        {filteredGames.length === 0 ? (<div className="p-4 text-center text-slate-500 text-xs">No games found</div>) : (
          filteredGames.map((game) => {
            const { month, day } = formatDate(game.date);
            const isSelected = selectedGameId === game.id;
            return (
            <div key={game.id} onClick={() => onSelectGame(game)} className={`px-3 py-2 cursor-pointer transition-all ${isDark ? 'hover:bg-cmd-card/50' : 'hover:bg-slate-50'} group relative ${isSelected ? 'bg-raptors-red/5' : ''}`}>
              {isSelected && <div className="absolute left-0 top-0 bottom-0 w-1 bg-raptors-red shadow-lg shadow-raptors-red/50"></div>}
              <div className="flex items-center gap-2">
                 <div className="flex-shrink-0 w-8 text-center"><div className="text-[9px] uppercase font-bold text-slate-500 leading-none">{month}</div><div className={`text-sm font-black ${isDark ? 'text-slate-200' : 'text-slate-800'} leading-none mt-0.5`}>{day}</div></div>
                 <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-1.5 mb-0.5">
                        <span className={`text-[10px] font-bold uppercase ${game.isHome ? 'text-slate-500' : 'text-slate-400'}`}>{game.isHome ? 'VS' : '@'}</span>
                        <div className="flex items-center gap-1.5 min-w-0">
                             {game.opponentId ? (<img src={`https://cdn.nba.com/logos/nba/${game.opponentId}/primary/L/logo.svg`} className="w-4 h-4 object-contain" alt={game.opponent} />) : (<div className={`w-4 h-4 rounded-full ${isDark ? 'bg-cmd-border' : 'bg-light-border'}`}></div>)}
                             <span className={`font-bold ${isDark ? 'text-slate-200' : 'text-slate-700'} text-xs truncate leading-none`}>{game.opponent}</span>
                        </div>
                    </div>
                 </div>
                 <div className="text-right">
                    {game.status === 'completed' && game.result ? (<div className={`text-[10px] font-bold ${game.result.startsWith('W') ? 'text-green-500' : 'text-red-500'}`} style={game.result.startsWith('W') ? {textShadow: isDark ? '0 0 6px rgba(74,222,128,0.3)' : 'none'} : {textShadow: isDark ? '0 0 6px rgba(248,113,113,0.3)' : 'none'}}>{game.result}</div>
                    ) : game.status === 'live' ? (<div className="text-[9px] bg-raptors-red text-white px-1.5 py-0.5 rounded shadow-lg shadow-raptors-red/40" style={{animation: 'glow-pulse 2s ease-in-out infinite'}}>LIVE</div>
                    ) : (<div className="text-[9px] text-raptors-red/80 bg-raptors-red/10 border border-raptors-red/20 px-1.5 py-0.5 rounded">UP</div>)}
                 </div>
              </div>
            </div>
            );
          })
        )}
      </div>
    </div>
  );
};

// ============================================================
// SUB-COMPONENTS FOR MATCHUP ANALYZER
// ============================================================
const PlayerCard = ({ player, onClick, onDeepDive, isOpponent, isSelected }) => {
    const [imgError, setImgError] = useState(false);
    return (
        <div className={`card-3d group relative rounded-xl overflow-hidden transition-all duration-300 cursor-pointer ${isSelected ? 'ring-2 ring-raptors-red scale-105 z-20 shadow-xl shadow-raptors-red/20' : 'hover-lift'} bg-cmd-card border border-cmd-border h-40 flex flex-col justify-end`} onClick={onClick}>
            <div className="absolute inset-0 bg-gradient-to-t from-cmd-bg via-transparent to-transparent opacity-95"></div>
            {!imgError ? (<img src={`https://cdn.nba.com/headshots/nba/latest/1040x760/${player.id}.png`} onError={() => setImgError(true)} className={`absolute top-0 left-1/2 -translate-x-1/2 w-[140%] max-w-none object-cover object-top h-full ${isOpponent ? 'grayscale-[0.3]' : ''}`} alt={player.name} />
            ) : (<div className={`absolute inset-0 flex flex-col items-center justify-center opacity-20 ${isOpponent ? 'text-blue-500' : 'text-raptors-red'}`}><div className="text-4xl font-black">{player.number}</div></div>)}
            <button onClick={(e) => { e.stopPropagation(); onDeepDive(); }} className="absolute top-1 right-1 z-30 p-1.5 rounded-full bg-cmd-surface/50 hover:bg-raptors-red text-white opacity-0 group-hover:opacity-100 transition-all backdrop-blur-sm" title="View Analytics"><ChevronRight className="w-3 h-3" /></button>
            {/* Form Indicator */}
            {player.form && <div className="absolute top-1 left-1 z-30"><FormIndicator form={player.form} /></div>}
            <div className="relative z-20 p-2 pointer-events-none">
                <div className={`text-[9px] font-black uppercase tracking-wider mb-0.5 ${isOpponent ? 'text-blue-400' : 'text-raptors-red'}`}>{player.position} • #{player.number}</div>
                <div className="text-white font-bold leading-tight text-xs mb-1 truncate">{player.name.split(' ').slice(1).join(' ')}</div>
                <div className="flex justify-between items-end border-t border-white/10 pt-1">
                    <div className="text-[9px] text-slate-400">PER {Number(player.advanced?.per || 0).toFixed(1)}</div>
                    <div className="text-[9px] font-mono font-bold text-white neon-text-subtle">{Number(player.seasonStats?.ppg || 0).toFixed(1)} PPG</div>
                </div>
            </div>
            {isSelected && (<div className="absolute inset-0 bg-raptors-red/20 z-10 flex items-center justify-center backdrop-blur-[2px]"><div className="bg-cmd-surface text-raptors-red px-2 py-1 rounded text-[10px] font-bold shadow-lg shadow-raptors-red/30 uppercase border border-raptors-red/30">Select Swap</div></div>)}
        </div>
    );
};

const BenchCard = ({ player, onClick, isOpponent, isHighlighted }) => {
    const [imgError, setImgError] = useState(false);
    return (
        <div onClick={onClick} className={`flex-shrink-0 w-16 h-20 rounded-lg overflow-hidden relative cursor-pointer group transition-all bg-cmd-card border ${isHighlighted ? 'ring-2 ring-raptors-red/50 border-raptors-red/30 shadow-lg shadow-raptors-red/10' : 'border-cmd-border hover:ring-2 hover:ring-raptors-red/30 hover:border-raptors-red/20'}`} style={isHighlighted ? {animation: 'border-glow 2s ease-in-out infinite'} : {}}>
             {!imgError ? (<img src={`https://cdn.nba.com/headshots/nba/latest/1040x760/${player.id}.png`} onError={() => setImgError(true)} className={`w-full h-full object-cover object-top ${isOpponent ? 'grayscale-[0.3]' : ''}`} alt={player.name} />) : (<div className="w-full h-full flex items-center justify-center text-xs font-bold text-slate-500">{player.number}</div>)}
            <div className="absolute bottom-0 inset-x-0 bg-cmd-bg/90 backdrop-blur-sm p-0.5 text-center">
                <div className="text-[8px] text-white font-bold truncate">{player.name.split(' ').pop()}</div>
                <div className="text-[7px] text-slate-400 font-mono">{Number(player.seasonStats?.ppg || 0).toFixed(1)}</div>
            </div>
        </div>
    );
};

const ComparisonRow = ({ label, raptorsVal, opponentVal, higherIsBetter }) => {
    const raptorsWins = higherIsBetter ? raptorsVal > opponentVal : raptorsVal < opponentVal;
    const opponentWins = higherIsBetter ? opponentVal > raptorsVal : opponentVal < raptorsVal;
    const tied = Math.abs(raptorsVal - opponentVal) < 0.05;
    const pct = Math.min(100, Math.max(5, (raptorsVal / (raptorsVal + opponentVal || 1)) * 100));
    return (
        <div className="flex items-center gap-3">
            <div className={`flex-1 text-right font-mono text-sm font-bold transition-colors ${tied ? 'text-slate-400' : raptorsWins ? 'text-green-400' : 'text-slate-500'}`} style={raptorsWins && !tied ? {textShadow: '0 0 8px rgba(74,222,128,0.3)'} : {}}>{raptorsVal.toFixed(1)}</div>
            <div className="flex-shrink-0 w-24">
                <div className="relative h-2 bg-cmd-border rounded-full overflow-hidden"><div className="absolute left-0 top-0 h-full bg-gradient-to-r from-raptors-red to-raptors-purple rounded-full" style={{ width: `${pct}%`, animation: 'bar-grow 1s ease-out both', transformOrigin: 'left' }} /></div>
                <div className="text-[9px] text-slate-500 text-center mt-1 font-medium">{label}</div>
            </div>
            <div className={`flex-1 text-left font-mono text-sm font-bold transition-colors ${tied ? 'text-slate-400' : opponentWins ? 'text-green-400' : 'text-slate-500'}`} style={opponentWins && !tied ? {textShadow: '0 0 8px rgba(74,222,128,0.3)'} : {}}>{opponentVal.toFixed(1)}</div>
        </div>
    );
};

// ============================================================
// MATCHUP ANALYZER (MAIN COMPONENT)
// ============================================================
const MatchupAnalyzer = ({ game }) => {
  const [analysis, setAnalysis] = useState(null);
  const [loading, setLoading] = useState(false);
  const [activeRaptorsLineup, setActiveRaptorsLineup] = useState([]);
  const [activeOpponentLineup, setActiveOpponentLineup] = useState([]);
  const [raptorsBench, setRaptorsBench] = useState([]);
  const [opponentBench, setOpponentBench] = useState([]);
  const [selectedSlot, setSelectedSlot] = useState(null);
  const [selectedPlay, setSelectedPlay] = useState(null);
  const [selectedPlayerForDeepDive, setSelectedPlayerForDeepDive] = useState(null);

  useEffect(() => {
    let mounted = true;
    const fetchAnalysis = async () => {
      setLoading(true); setAnalysis(null);
      const result = await analyzeGameMatchup(game.opponent);
      if (mounted && result.analysis) {
        setAnalysis(result.analysis);
        const raptors = result.analysis.raptorsRoster || [];
        const opponents = result.analysis.opponentRoster || [];
        const rapStarters = raptors.slice(0, 5);
        const oppStarters = opponents.slice(0, 5);
        setActiveRaptorsLineup(rapStarters);
        setActiveOpponentLineup(oppStarters);
        setRaptorsBench(raptors.filter(p => !rapStarters.find(s => s.id === p.id)));
        setOpponentBench(opponents.filter(p => !oppStarters.find(s => s.id === p.id)));
        if (result.analysis.playbook?.length > 0) setSelectedPlay(result.analysis.playbook[0]);
        setLoading(false);
      }
    };
    fetchAnalysis();
    return () => { mounted = false; };
  }, [game]);

  const handleBenchClick = (player, team) => {
      if (selectedSlot && selectedSlot.team === team) {
          if (team === 'raptors') {
              const currentActive = activeRaptorsLineup[selectedSlot.index];
              const newActive = [...activeRaptorsLineup];
              newActive[selectedSlot.index] = player;
              setActiveRaptorsLineup(newActive);
              setRaptorsBench(prev => [...prev.filter(p => p.id !== player.id), currentActive]);
          } else {
              const currentActive = activeOpponentLineup[selectedSlot.index];
              const newActive = [...activeOpponentLineup];
              newActive[selectedSlot.index] = player;
              setActiveOpponentLineup(newActive);
              setOpponentBench(prev => [...prev.filter(p => p.id !== player.id), currentActive]);
          }
          setSelectedSlot(null);
      }
  };

  const applyRaptorsPreset = (presetName) => {
      if (!analysis) return;
      const allRaptors = analysis.raptorsRoster || [];
      let newActive = [];
      if (presetName === 'starters') { newActive = allRaptors.slice(0, 5); }
      else if (presetName === 'second') { newActive = allRaptors.slice(5, 10); if (newActive.length < 5) { newActive = [...newActive, ...allRaptors.filter(p => !newActive.includes(p)).slice(0, 5 - newActive.length)]; } }
      else if (presetName === 'speed') { newActive = [...allRaptors].filter(p => p.position.includes('G') || p.position.includes('SF')).slice(0, 5); if (newActive.length < 5) { newActive = [...newActive, ...allRaptors.filter(p => !newActive.includes(p)).slice(0, 5 - newActive.length)]; } }
      else if (presetName === 'big') { newActive = [...allRaptors].filter(p => p.position.includes('C') || p.position.includes('PF') || p.position.includes('F')).slice(0, 5); if (newActive.length < 5) { newActive = [...newActive, ...allRaptors.filter(p => !newActive.includes(p)).slice(0, 5 - newActive.length)]; } }
      if (newActive.length < 5) newActive = allRaptors.slice(0, 5);
      setActiveRaptorsLineup(newActive.slice(0, 5));
      setRaptorsBench(allRaptors.filter(p => !newActive.find(a => a.id === p.id)));
      setSelectedSlot(null);
  };

  const applyPreset = (presetName) => {
      if (!analysis || !analysis.lineupPresets) return;
      const allOpponents = analysis.opponentRoster || [];
      let newActive = [];
      const preset = analysis.lineupPresets.find(p => p.name.toLowerCase().includes(presetName.toLowerCase()));
      if (preset && preset.playerIds && preset.playerIds.length > 0) newActive = allOpponents.filter(p => preset.playerIds.includes(p.id));
      if (newActive.length < 5) {
          if (presetName === 'bench' || presetName === 'second') newActive = allOpponents.slice(5, 10);
          else if (presetName === 'speed') newActive = [...allOpponents].filter(p => p.position.includes('G') || p.position.includes('F')).slice(0,5);
          else newActive = allOpponents.slice(0, 5);
      }
      if (newActive.length < 5) { newActive = [...newActive, ...allOpponents.filter(p => !newActive.includes(p)).slice(0, 5 - newActive.length)]; }
      setActiveOpponentLineup(newActive.slice(0, 5));
      setOpponentBench(allOpponents.filter(p => !newActive.find(a => a.id === p.id)));
  };

  const calculateAggregates = (players) => {
    if (!players.length) return { ortg: 0, drtg: 0, per: 0, net: 0 };
    const avg = (key, subKey) => players.reduce((sum, p) => sum + (p[key]?.[subKey] || 0), 0) / players.length;
    const ortg = avg('advanced', 'ortg');
    const drtg = avg('advanced', 'drtg');
    return { ortg, drtg, per: avg('advanced', 'per'), net: ortg - drtg };
  };

  const raptorsAgg = calculateAggregates(activeRaptorsLineup);
  const opponentAgg = calculateAggregates(activeOpponentLineup);

  if (loading) return (
    <div className="h-full flex flex-col items-center justify-center space-y-6 p-12">
       <div className="relative w-24 h-24">
         <div className="absolute inset-0 rounded-full border-4 border-raptors-red/20"></div>
         <div className="absolute inset-0 rounded-full border-4 border-raptors-red border-t-transparent animate-spin"></div>
         <div className="absolute inset-2 rounded-full" style={{background: 'radial-gradient(circle, rgba(206,17,65,0.15) 0%, transparent 70%)'}}></div>
       </div>
       <div className="text-center">
         <h2 className="text-xl font-bold text-white uppercase tracking-wider neon-text">Scouting {game.opponent}...</h2>
         <p className="text-slate-500 mt-2">Gathering injury reports, film study, and social sentiment.</p>
         <div className="mt-4 w-48 h-1 mx-auto rounded-full overflow-hidden bg-cmd-border"><div className="h-full shimmer-bg bg-raptors-red/20 w-full"></div></div>
       </div>
    </div>
  );

  if (!analysis) return <div className="p-8 text-center text-slate-500">Select a game to begin scouting.</div>;

  return (
    <div className="space-y-6 pb-20 animate-fade-in relative">
      {/* 1. MATCHUP HEADER */}
      <div className="glass-card gradient-border p-8 relative overflow-hidden animate-slide-up">
         <div className="absolute inset-0 bg-grid opacity-30"></div>
         <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] rounded-full" style={{background: 'radial-gradient(circle, rgba(206,17,65,0.08) 0%, transparent 70%)'}}></div>
         <div className="absolute top-0 right-0 p-4 opacity-[0.04] animate-float"><img src={`https://cdn.nba.com/logos/nba/${game.opponentId}/primary/L/logo.svg`} className="w-64 h-64" alt="logo" /></div>
         <div className="relative z-10 flex flex-col md:flex-row gap-8">
             <div className="flex-1">
                <div className="flex items-center gap-3 mb-2"><span className="bg-raptors-red/20 text-raptors-red border border-raptors-red/30 px-2 py-0.5 rounded text-xs font-bold uppercase">Game Prep</span><span className="text-slate-500 text-sm font-mono">{game.date} &bull; {game.venue}</span></div>
                <h1 className="text-4xl md:text-6xl font-black text-white italic uppercase tracking-tighter mb-4 neon-text" style={{animation: 'text-reveal 0.8s ease-out both'}}>Raptors vs {game.opponent}</h1>
                <p className="text-lg text-slate-400 max-w-2xl leading-relaxed border-l-4 border-raptors-red/50 pl-4">{analysis.summary}</p>
             </div>
             <div className="flex gap-4 items-end">
                <WinProbRing value={analysis.winProbability} size={100} />
                <div className="h-12 w-px bg-cmd-border"></div>
                <div className="text-center"><div className="text-4xl font-black text-white neon-text-subtle"><AnimatedCounter value={raptorsAgg.per} /></div><div className="text-xs text-slate-500 uppercase font-bold">TOR PER</div></div>
                <div className="h-12 w-px bg-cmd-border"></div>
                <div className="text-center"><div className="text-4xl font-black text-white"><AnimatedCounter value={opponentAgg.per} /></div><div className="text-xs text-slate-500 uppercase font-bold">OPP PER</div></div>
             </div>
         </div>
      </div>

      {/* 2. STRATEGIC GAME PLAN */}
      <div className="glass-card p-6 animate-slide-up" style={{animationDelay: '0.15s'}}>
          <div className="flex items-center gap-3 mb-6 pb-4 border-b border-cmd-border"><Brain className="w-6 h-6 text-raptors-red" /><h2 className="text-2xl font-bold text-white">Strategic Game Plan</h2></div>
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
              <div className="space-y-6">
                 <div><div className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-3">Offensive Profile</div><div className="flex flex-wrap gap-2">{analysis.scoutingReport.offensiveTendencies.map((t, i) => (<span key={i} className="bg-raptors-red/10 text-raptors-red/90 text-sm px-3 py-1.5 rounded-full font-medium border border-raptors-red/20 hover:bg-raptors-red/20 hover:shadow-lg hover:shadow-raptors-red/10 transition-all cursor-default">{t}</span>))}</div></div>
                 <div><div className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-3">Defensive Schemes</div><div className="flex flex-wrap gap-2">{analysis.scoutingReport.defensiveSchemes.map((t, i) => (<span key={i} className="bg-blue-500/10 text-blue-400 text-sm px-3 py-1.5 rounded-full font-medium border border-blue-500/20 hover:bg-blue-500/20 transition-all cursor-default">{t}</span>))}</div></div>
              </div>
              <div className="bg-cmd-bg/50 rounded-xl p-5 border border-cmd-border">
                  <h3 className="text-sm font-bold text-white uppercase tracking-wider mb-4 flex items-center gap-2"><Zap className="w-4 h-4 text-yellow-500 fill-yellow-500" /> Keys to Victory</h3>
                  <ul className="space-y-4">{analysis.scoutingReport.keysToVictory.map((key, i) => (<li key={i} className="flex gap-3 text-sm text-slate-300" style={{animation: `slide-up 0.4s ease-out ${0.1 * i}s both`}}><span className="flex-shrink-0 w-6 h-6 rounded-full bg-raptors-red/20 text-raptors-red border border-raptors-red/30 flex items-center justify-center font-bold text-xs shadow-lg shadow-raptors-red/10">{i+1}</span><span className="pt-0.5 font-medium leading-snug">{key}</span></li>))}</ul>
              </div>
              <div className="relative overflow-hidden rounded-xl bg-gradient-to-br from-cmd-surface to-cmd-bg p-6 text-white flex flex-col justify-center animate-glow-pulse border border-raptors-red/10">
                  <div className="absolute top-0 right-0 p-4 opacity-10 animate-float"><Activity className="w-32 h-32" /></div>
                  <div className="relative z-10"><div className="text-xs font-bold text-raptors-red uppercase tracking-widest mb-2">X-Factor Matchup</div><div className="text-3xl font-black italic mb-2 neon-text">{analysis.scoutingReport.xFactor}</div><p className="text-slate-400 text-sm leading-relaxed">"Controlling this player's impact is crucial for the defensive rotation scheme."</p></div>
              </div>
          </div>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 animate-slide-up" style={{animationDelay: '0.3s'}}>
          {/* 3. MEDIA & INTEL */}
          <div className="glass-card overflow-hidden flex flex-col">
              <div className="bg-cmd-bg/50 px-6 py-4 border-b border-cmd-border flex items-center justify-between"><h2 className="text-lg font-bold text-white flex items-center gap-2"><Radio className="text-raptors-red w-5 h-5" /> Media Row & Medical</h2></div>
              <div className="p-6 grid grid-cols-1 md:grid-cols-2 gap-6 flex-1">
                  <div>
                      <div className="flex items-center gap-2 mb-4"><AlertTriangle className="text-orange-500 w-4 h-4" /><span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Injury Report</span></div>
                      <div className="space-y-3">
                          {analysis.intel?.injuries?.length > 0 ? analysis.intel.injuries.map((inj, i) => (
                              <div key={i} className={`flex items-start gap-3 bg-cmd-bg/50 p-3 rounded-lg border transition-all ${inj.status === 'Out' ? 'border-l-2 border-l-red-500 border-red-500/20' : inj.status === 'Active' ? 'border-l-2 border-l-green-500 border-green-500/20' : 'border-l-2 border-l-yellow-500 border-yellow-500/20'}`}>
                                  {inj.status === 'Out' && <div className="absolute -top-1 -right-1 z-10"></div>}
                                  <div className={`mt-1 w-1.5 h-1.5 rounded-full flex-shrink-0 ${inj.status === 'Out' ? 'bg-red-500' : inj.status === 'Active' ? 'bg-green-500' : 'bg-yellow-500'}`} style={inj.status === 'Out' ? {animation: 'pulse-dot 1.5s ease-in-out infinite'} : {}}></div>
                                  <div><div className="flex items-center gap-2 flex-wrap"><span className="text-sm font-bold text-white">{inj.player}</span>{inj.status === 'Out' && <span className="text-[8px] px-1.5 py-0.5 rounded bg-red-500/20 text-red-400 border border-red-500/30 font-black uppercase tracking-wider">BREAKING</span>}<span className={`text-[10px] px-1.5 rounded uppercase font-bold ${inj.status === 'Out' ? 'bg-red-500/20 text-red-400' : inj.status === 'Active' ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'}`}>{inj.status}</span></div><div className="text-xs text-slate-500 mt-1">{inj.details}</div></div>
                              </div>
                          )) : (<div className="text-slate-500 text-sm italic">No significant injuries reported.</div>)}
                      </div>
                  </div>
                  <div>
                      <div className="flex items-center gap-2 mb-4"><MessageSquare className="text-blue-400 w-4 h-4" /><span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Social Feed</span></div>
                      <div className="space-y-4">
                          {analysis.intel?.socialChatter?.map((item, i) => {
                              const isRaptors = item.source.toLowerCase().includes('raptors') || item.source.toLowerCase().includes('republic');
                              const isOpponentSrc = item.source.toLowerCase().includes(game.opponent.toLowerCase());
                              let avatar = 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png';
                              if (item.source.toLowerCase().includes('espn')) avatar = 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/ESPN_logo.svg/1200px-ESPN_logo.svg.png';
                              if (isRaptors) avatar = 'https://cdn.nba.com/logos/nba/1610612761/primary/L/logo.svg';
                              if (isOpponentSrc && game.opponentId) avatar = `https://cdn.nba.com/logos/nba/${game.opponentId}/primary/L/logo.svg`;
                              const sentimentColor = item.sentiment === 'positive' ? 'border-l-green-500' : item.sentiment === 'negative' ? 'border-l-red-500' : 'border-l-blue-500';
                              return (
                                <div key={i} className={`bg-cmd-bg/50 border border-cmd-border border-l-2 ${sentimentColor} rounded-xl p-4 hover-lift`}>
                                    <div className="flex gap-3">
                                        <div className="flex-shrink-0"><img src={avatar} onError={(e) => e.currentTarget.src = 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png'} alt="avatar" className="w-10 h-10 rounded-full object-contain border border-cmd-border bg-cmd-surface p-1" /></div>
                                        <div className="flex-1 min-w-0"><div className="flex items-center justify-between"><span className="text-sm font-bold text-white truncate">{item.source}</span><span className="text-xs text-slate-500">2h</span></div><p className="text-sm text-slate-300 mt-1 leading-snug">{item.headline}</p></div>
                                    </div>
                                </div>
                              );
                          })}
                      </div>
                  </div>
              </div>
          </div>

          {/* 4. TACTICAL PLAYBOOK */}
          <div className="glass-card flex flex-col overflow-hidden">
             <div className="bg-cmd-bg/50 px-6 py-4 border-b border-cmd-border flex items-center justify-between"><h3 className="text-lg font-bold text-white flex items-center gap-2"><LayoutTemplate className="text-orange-500 w-5 h-5" /> Interactive Playbook</h3></div>
             <div className="flex flex-col md:flex-row h-auto md:h-[450px]">
                 <div className="w-full md:w-3/5 bg-cmd-bg/30 p-4 md:p-8 flex flex-col justify-center items-center">
                     <div className="rounded-lg overflow-hidden border-2 border-cmd-border shadow-xl shadow-raptors-red/5 w-full max-w-lg aspect-[1.6]"><CourtDiagram play={selectedPlay} /></div>
                 </div>
                 <div className="w-full md:w-2/5 flex flex-col border-l border-cmd-border bg-cmd-surface/50 overflow-hidden">
                     <div className="p-4 border-b border-cmd-border bg-cmd-bg/30 flex-shrink-0">
                        <div className="flex gap-2 overflow-x-auto pb-1 scrollbar-hide">
                            {analysis.playbook?.map((play) => (<button key={play.id} onClick={() => setSelectedPlay(play)} className={`flex-shrink-0 px-3 py-1.5 rounded-full text-xs font-bold transition-all border ${selectedPlay?.id === play.id ? 'bg-raptors-red text-white border-raptors-red shadow-lg shadow-raptors-red/30' : 'bg-cmd-surface text-slate-400 border-cmd-border hover:border-raptors-red/30 hover:text-white'}`}>{play.name}</button>))}
                        </div>
                     </div>
                     <div className="flex-1 p-6 overflow-y-auto custom-scrollbar">
                         {selectedPlay ? (
                             <div className="space-y-6">
                                <div><div className="flex items-center justify-between mb-3"><h4 className="font-black text-xl text-white uppercase italic tracking-tighter">{selectedPlay.name}</h4><span className="text-[10px] font-bold bg-cmd-bg text-slate-400 border border-cmd-border px-2 py-1 rounded uppercase">{selectedPlay.diagramType}</span></div><p className="text-sm text-slate-400 leading-snug">{selectedPlay.description}</p></div>
                                <div><div className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Execution Steps</div><div className="space-y-3 relative pl-2"><div className="absolute left-[11px] top-2 bottom-2 w-px bg-raptors-red/20"></div>{selectedPlay.execution?.map((step, i) => (<div key={i} className="flex gap-3 relative" style={{animation: `slide-up 0.4s ease-out ${0.1 * i}s both`}}><div className="w-6 h-6 rounded-full bg-cmd-surface border-2 border-raptors-red/30 flex items-center justify-center text-[10px] font-bold text-raptors-red flex-shrink-0 z-10">{i+1}</div><p className="text-sm text-slate-300 pt-0.5">{step}</p></div>))}</div></div>
                                <div className="bg-raptors-red/5 border border-raptors-red/20 p-4 rounded-xl mt-4" style={{animation: 'border-glow 3s ease-in-out infinite'}}><div className="flex items-center gap-1.5 mb-2"><Shield className="w-4 h-4 text-raptors-red" /><span className="text-xs font-bold text-raptors-red uppercase tracking-widest">Defensive Key</span></div><p className="text-sm text-white font-bold leading-relaxed">{selectedPlay.raptorsCounter}</p></div>
                             </div>
                         ) : (<div className="flex flex-col items-center justify-center h-full text-slate-500 space-y-2"><Activity className="w-8 h-8 opacity-20" /><span className="text-sm font-medium">Select a play to view details</span></div>)}
                     </div>
                 </div>
             </div>
          </div>
      </div>

      {/* 5. GAME CONTEXT - REST, REFS, PACE */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 animate-slide-up" style={{animationDelay: '0.4s'}}>
          {/* Rest Days */}
          <div className="glass-card p-4">
              <div className="flex items-center gap-2 mb-3"><Clock className="w-4 h-4 text-blue-400" /><span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Rest Advantage</span></div>
              <div className="flex justify-between items-center">
                  <div className="text-center">
                      <div className="text-3xl font-black text-white">{analysis.intel?.restDays?.raptors || 2}</div>
                      <div className="text-[10px] text-slate-500 uppercase">TOR Days</div>
                  </div>
                  <div className="text-slate-600">vs</div>
                  <div className="text-center">
                      <div className="text-3xl font-black text-slate-400">{analysis.intel?.restDays?.opponent || 1}</div>
                      <div className="text-[10px] text-slate-500 uppercase">OPP Days</div>
                  </div>
              </div>
              {analysis.intel?.backToBack?.opponent && (
                  <div className="mt-3 px-2 py-1.5 bg-yellow-500/10 border border-yellow-500/20 rounded-lg text-center">
                      <span className="text-[10px] font-bold text-yellow-400 uppercase">⚠️ {game.opponent} on B2B</span>
                  </div>
              )}
              {analysis.intel?.backToBack?.raptors && (
                  <div className="mt-3 px-2 py-1.5 bg-red-500/10 border border-red-500/20 rounded-lg text-center">
                      <span className="text-[10px] font-bold text-red-400 uppercase">⚠️ Raptors on B2B</span>
                  </div>
              )}
          </div>

          {/* Referee Crew */}
          <div className="glass-card p-4">
              <div className="flex items-center gap-2 mb-3"><Gavel className="w-4 h-4 text-purple-400" /><span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Officials</span></div>
              <div className="space-y-2">
                  {analysis.intel?.referees?.map((ref, i) => (
                      <div key={i} className="flex items-center justify-between p-2 bg-cmd-bg/50 rounded-lg border border-cmd-border">
                          <div>
                              <div className="text-sm font-bold text-white">{ref.name}</div>
                              <div className="text-[10px] text-slate-500">{ref.role}</div>
                          </div>
                          <div className="text-right">
                              <div className="text-xs font-mono text-slate-300">{ref.foulCallRate} F/G</div>
                              <div className="text-[9px] text-slate-500 italic">{ref.tendency}</div>
                          </div>
                      </div>
                  ))}
              </div>
          </div>

          {/* Pace Comparison */}
          <div className="glass-card p-4">
              <div className="flex items-center gap-2 mb-3"><Gauge className="w-4 h-4 text-green-400" /><span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Pace Factor</span></div>
              <div className="space-y-3">
                  <div>
                      <div className="flex justify-between items-center mb-1">
                          <span className="text-xs text-raptors-red font-bold">TOR</span>
                          <span className="text-sm font-mono text-white">{analysis.intel?.pace?.raptors || 101.2}</span>
                      </div>
                      <div className="w-full bg-cmd-border h-2 rounded-full overflow-hidden">
                          <div className="bg-raptors-red h-full rounded-full" style={{width: `${((analysis.intel?.pace?.raptors || 101.2) / 110) * 100}%`}}></div>
                      </div>
                  </div>
                  <div>
                      <div className="flex justify-between items-center mb-1">
                          <span className="text-xs text-blue-400 font-bold">{game.opponent?.slice(0,3).toUpperCase()}</span>
                          <span className="text-sm font-mono text-white">{analysis.intel?.pace?.opponent || 98.5}</span>
                      </div>
                      <div className="w-full bg-cmd-border h-2 rounded-full overflow-hidden">
                          <div className="bg-blue-500 h-full rounded-full" style={{width: `${((analysis.intel?.pace?.opponent || 98.5) / 110) * 100}%`}}></div>
                      </div>
                  </div>
                  <div className="text-center pt-2 border-t border-cmd-border">
                      <span className="text-[10px] text-slate-500">League Avg: {analysis.intel?.pace?.leagueAvg || 99.8}</span>
                  </div>
              </div>
          </div>

          {/* Home/Away Splits */}
          <div className="glass-card p-4">
              <div className="flex items-center gap-2 mb-3"><Home className="w-4 h-4 text-orange-400" /><span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Venue Splits</span></div>
              <div className="space-y-3">
                  <div className="flex items-center justify-between p-2 bg-cmd-bg/50 rounded-lg border border-cmd-border">
                      <div className="flex items-center gap-2">
                          <img src="https://cdn.nba.com/logos/nba/1610612761/primary/L/logo.svg" className="w-5 h-5" alt="TOR" />
                          <span className="text-xs font-bold text-white">TOR</span>
                      </div>
                      <div className="flex gap-3 text-xs">
                          <span className="text-green-400"><Home className="w-3 h-3 inline mr-1" />{analysis.intel?.homeSplits?.raptors?.home || "14-12"}</span>
                          <span className="text-slate-400"><Plane className="w-3 h-3 inline mr-1" />{analysis.intel?.homeSplits?.raptors?.away || "9-20"}</span>
                      </div>
                  </div>
                  <div className="flex items-center justify-between p-2 bg-cmd-bg/50 rounded-lg border border-cmd-border">
                      <div className="flex items-center gap-2">
                          {game.opponentId && <img src={`https://cdn.nba.com/logos/nba/${game.opponentId}/primary/L/logo.svg`} className="w-5 h-5" alt="" />}
                          <span className="text-xs font-bold text-white">{game.opponent?.slice(0,3).toUpperCase()}</span>
                      </div>
                      <div className="flex gap-3 text-xs">
                          <span className="text-green-400"><Home className="w-3 h-3 inline mr-1" />{analysis.intel?.homeSplits?.opponent?.home || "18-8"}</span>
                          <span className="text-slate-400"><Plane className="w-3 h-3 inline mr-1" />{analysis.intel?.homeSplits?.opponent?.away || "14-14"}</span>
                      </div>
                  </div>
              </div>
          </div>
      </div>

      {/* 5.5 ADVANCED BATTLE METRICS */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 animate-slide-up" style={{animationDelay: '0.45s'}}>
          {/* Rebounding Battle */}
          <div className="glass-card p-4">
              <div className="flex items-center gap-2 mb-3"><ArrowRightLeft className="w-4 h-4 text-cyan-400" /><span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Rebounding</span></div>
              <div className="grid grid-cols-2 gap-3">
                  <div className="text-center p-2 bg-raptors-red/10 rounded-lg border border-raptors-red/20">
                      <div className="text-xl font-black text-white">{analysis.intel?.rebounding?.raptors?.total || 43.7}</div>
                      <div className="text-[9px] text-slate-500 uppercase">TOR RPG</div>
                      <div className="text-[10px] text-raptors-red mt-1">{analysis.intel?.rebounding?.raptors?.oreb || 10.2} OFF</div>
                  </div>
                  <div className="text-center p-2 bg-blue-500/10 rounded-lg border border-blue-500/20">
                      <div className="text-xl font-black text-white">{analysis.intel?.rebounding?.opponent?.total || 45.7}</div>
                      <div className="text-[9px] text-slate-500 uppercase">OPP RPG</div>
                      <div className="text-[10px] text-blue-400 mt-1">{analysis.intel?.rebounding?.opponent?.oreb || 11.5} OFF</div>
                  </div>
              </div>
              <div className="mt-3 pt-2 border-t border-cmd-border">
                  <div className="flex justify-between text-[10px]">
                      <span className="text-slate-500">OREB%</span>
                      <span className="text-raptors-red font-bold">{analysis.intel?.rebounding?.raptors?.orebPct || 26.8}%</span>
                      <span className="text-blue-400 font-bold">{analysis.intel?.rebounding?.opponent?.orebPct || 28.1}%</span>
                  </div>
              </div>
          </div>

          {/* Free Throw Battle */}
          <div className="glass-card p-4">
              <div className="flex items-center gap-2 mb-3"><Target className="w-4 h-4 text-yellow-400" /><span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Free Throws</span></div>
              <div className="space-y-2">
                  <div className="flex justify-between items-center p-2 bg-cmd-bg/50 rounded-lg">
                      <span className="text-xs text-raptors-red font-bold">TOR</span>
                      <div className="flex gap-3 text-xs">
                          <span className="text-white font-mono">{analysis.intel?.freeThrows?.raptors?.ftPct || 78.5}%</span>
                          <span className="text-slate-400">{analysis.intel?.freeThrows?.raptors?.ftaPerGame || 21.3} FTA</span>
                      </div>
                  </div>
                  <div className="flex justify-between items-center p-2 bg-cmd-bg/50 rounded-lg">
                      <span className="text-xs text-blue-400 font-bold">OPP</span>
                      <div className="flex gap-3 text-xs">
                          <span className="text-white font-mono">{analysis.intel?.freeThrows?.opponent?.ftPct || 76.2}%</span>
                          <span className="text-slate-400">{analysis.intel?.freeThrows?.opponent?.ftaPerGame || 23.8} FTA</span>
                      </div>
                  </div>
              </div>
              <div className="mt-2 text-center">
                  <span className="text-[9px] text-slate-500">FT Rate: TOR {((analysis.intel?.freeThrows?.raptors?.ftRate || 0.268) * 100).toFixed(1)}% | OPP {((analysis.intel?.freeThrows?.opponent?.ftRate || 0.285) * 100).toFixed(1)}%</span>
              </div>
          </div>

          {/* Quarter Scoring */}
          <div className="glass-card p-4">
              <div className="flex items-center gap-2 mb-3"><Timer className="w-4 h-4 text-pink-400" /><span className="text-xs font-bold text-slate-500 uppercase tracking-wider">By Quarter</span></div>
              <div className="space-y-1.5">
                  {['Q1', 'Q2', 'Q3', 'Q4'].map((q, i) => {
                      const qKey = q.toLowerCase();
                      const torVal = analysis.intel?.quarterScoring?.raptors?.[qKey] || [27.5, 28.2, 26.8, 29.3][i];
                      const oppVal = analysis.intel?.quarterScoring?.opponent?.[qKey] || [28.1, 27.5, 28.9, 27.2][i];
                      const torWins = torVal > oppVal;
                      return (
                          <div key={q} className="flex items-center gap-2 text-xs">
                              <span className="w-6 text-slate-500 font-bold">{q}</span>
                              <div className="flex-1 flex items-center gap-1">
                                  <span className={`font-mono ${torWins ? 'text-green-400' : 'text-slate-400'}`}>{torVal}</span>
                                  <div className="flex-1 h-1.5 bg-cmd-border rounded-full overflow-hidden flex">
                                      <div className="bg-raptors-red h-full" style={{width: `${(torVal / (torVal + oppVal)) * 100}%`}}></div>
                                      <div className="bg-blue-500 h-full flex-1"></div>
                                  </div>
                                  <span className={`font-mono ${!torWins ? 'text-green-400' : 'text-slate-400'}`}>{oppVal}</span>
                              </div>
                          </div>
                      );
                  })}
              </div>
          </div>

          {/* Season Series */}
          <div className="glass-card p-4">
              <div className="flex items-center gap-2 mb-3"><Trophy className="w-4 h-4 text-amber-400" /><span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Season Series</span></div>
              <div className="text-center mb-3">
                  <div className="flex justify-center items-center gap-4">
                      <div>
                          <div className="text-2xl font-black text-raptors-red">{analysis.intel?.seasonSeries?.raptorsWins || 1}</div>
                          <div className="text-[9px] text-slate-500">TOR</div>
                      </div>
                      <span className="text-slate-600 text-xl">-</span>
                      <div>
                          <div className="text-2xl font-black text-blue-400">{analysis.intel?.seasonSeries?.opponentWins || 1}</div>
                          <div className="text-[9px] text-slate-500">OPP</div>
                      </div>
                  </div>
              </div>
              <div className="space-y-1.5">
                  {(analysis.intel?.seasonSeries?.games || [
                      { date: "Nov 15", result: "W 112-105", topScorer: "Barnes - 28" },
                      { date: "Jan 8", result: "L 98-115", topScorer: "Barrett - 22" }
                  ]).map((g, i) => (
                      <div key={i} className={`text-[10px] p-1.5 rounded ${g.result.startsWith('W') ? 'bg-green-500/10 text-green-400' : 'bg-red-500/10 text-red-400'}`}>
                          <span className="font-bold">{g.date}:</span> {g.result}
                      </div>
                  ))}
              </div>
          </div>
      </div>

      {/* 5.75 TREND ANALYSIS */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 animate-slide-up" style={{animationDelay: '0.5s'}}>
          {/* Last 10 Games Trend */}
          <div className="glass-card p-4">
              <div className="flex items-center gap-2 mb-3"><TrendingUp className="w-4 h-4 text-emerald-400" /><span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Last 10 Games Scoring</span></div>
              <div className="h-40">
                  <ResponsiveContainer width="100%" height="100%">
                      <AreaChart data={(analysis.intel?.lastTenTrend?.raptors || [105, 112, 98, 118, 108, 115, 122, 110, 119, 114]).map((pts, i) => ({
                          game: `G${i+1}`,
                          TOR: pts,
                          OPP: (analysis.intel?.lastTenTrend?.opponent || [110, 102, 115, 108, 99, 112, 105, 118, 108, 111])[i]
                      }))}>
                          <defs>
                              <linearGradient id="torGrad" x1="0" y1="0" x2="0" y2="1">
                                  <stop offset="5%" stopColor="#CE1141" stopOpacity={0.3}/>
                                  <stop offset="95%" stopColor="#CE1141" stopOpacity={0}/>
                              </linearGradient>
                              <linearGradient id="oppGrad" x1="0" y1="0" x2="0" y2="1">
                                  <stop offset="5%" stopColor="#6366f1" stopOpacity={0.3}/>
                                  <stop offset="95%" stopColor="#6366f1" stopOpacity={0}/>
                              </linearGradient>
                          </defs>
                          <CartesianGrid strokeDasharray="3 3" stroke="#1e293b" />
                          <XAxis dataKey="game" tick={{ fontSize: 10, fill: '#64748b' }} />
                          <YAxis domain={[90, 130]} tick={{ fontSize: 10, fill: '#64748b' }} />
                          <Tooltip contentStyle={{ backgroundColor: '#111827', borderColor: '#1e293b', borderRadius: '8px', fontSize: '11px' }} />
                          <Area type="monotone" dataKey="TOR" stroke="#CE1141" fill="url(#torGrad)" strokeWidth={2} />
                          <Area type="monotone" dataKey="OPP" stroke="#6366f1" fill="url(#oppGrad)" strokeWidth={2} />
                      </AreaChart>
                  </ResponsiveContainer>
              </div>
          </div>

          {/* Clutch Performance */}
          <div className="glass-card p-4">
              <div className="flex items-center gap-2 mb-3"><Zap className="w-4 h-4 text-yellow-400 fill-yellow-400" /><span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Clutch Time (±5 pts, &lt;5 min)</span></div>
              <div className="grid grid-cols-2 gap-4">
                  <div className="bg-raptors-red/10 border border-raptors-red/20 rounded-xl p-4 text-center">
                      <div className="text-2xl font-black text-white mb-1">{analysis.intel?.clutchStats?.raptors?.record || "8-5"}</div>
                      <div className="text-[10px] text-slate-500 uppercase mb-3">TOR Clutch Record</div>
                      <div className="grid grid-cols-2 gap-2 text-xs">
                          <div><span className="text-slate-400">PPG:</span> <span className="text-white font-bold">{analysis.intel?.clutchStats?.raptors?.ppg || 4.8}</span></div>
                          <div><span className="text-slate-400">FG%:</span> <span className="text-white font-bold">{analysis.intel?.clutchStats?.raptors?.fgPct || 45.2}%</span></div>
                      </div>
                      <div className={`mt-2 text-sm font-mono font-bold ${(analysis.intel?.clutchStats?.raptors?.plusMinus || 2.1) >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                          {(analysis.intel?.clutchStats?.raptors?.plusMinus || 2.1) > 0 ? '+' : ''}{analysis.intel?.clutchStats?.raptors?.plusMinus || 2.1}
                      </div>
                  </div>
                  <div className="bg-blue-500/10 border border-blue-500/20 rounded-xl p-4 text-center">
                      <div className="text-2xl font-black text-white mb-1">{analysis.intel?.clutchStats?.opponent?.record || "6-7"}</div>
                      <div className="text-[10px] text-slate-500 uppercase mb-3">OPP Clutch Record</div>
                      <div className="grid grid-cols-2 gap-2 text-xs">
                          <div><span className="text-slate-400">PPG:</span> <span className="text-white font-bold">{analysis.intel?.clutchStats?.opponent?.ppg || 4.2}</span></div>
                          <div><span className="text-slate-400">FG%:</span> <span className="text-white font-bold">{analysis.intel?.clutchStats?.opponent?.fgPct || 41.8}%</span></div>
                      </div>
                      <div className={`mt-2 text-sm font-mono font-bold ${(analysis.intel?.clutchStats?.opponent?.plusMinus || -1.5) >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                          {(analysis.intel?.clutchStats?.opponent?.plusMinus || -1.5) > 0 ? '+' : ''}{analysis.intel?.clutchStats?.opponent?.plusMinus || -1.5}
                      </div>
                  </div>
              </div>
          </div>
      </div>

      {/* 5.9 ASSIST NETWORK & DEFENSE */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 animate-slide-up" style={{animationDelay: '0.55s'}}>
          {/* Assist Distribution */}
          <div className="glass-card p-4">
              <div className="flex items-center gap-2 mb-3"><Share className="w-4 h-4 text-teal-400" /><span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Top Assist Connections</span></div>
              <div className="grid grid-cols-2 gap-4">
                  <div>
                      <div className="text-[10px] text-raptors-red font-bold mb-2 uppercase">Toronto</div>
                      <div className="space-y-2">
                          {(analysis.intel?.assistDistribution?.raptors || [
                              { from: "Quickley", to: "Barnes", pct: 18 },
                              { from: "Quickley", to: "Ingram", pct: 15 },
                              { from: "Barnes", to: "Poeltl", pct: 12 }
                          ]).slice(0, 3).map((conn, i) => (
                              <div key={i} className="flex items-center gap-2 text-xs">
                                  <div className="flex-1 flex items-center gap-1">
                                      <span className="text-white font-medium truncate">{conn.from}</span>
                                      <span className="text-raptors-red">→</span>
                                      <span className="text-slate-400 truncate">{conn.to}</span>
                                  </div>
                                  <div className="w-12 h-1.5 bg-cmd-border rounded-full overflow-hidden">
                                      <div className="h-full bg-raptors-red rounded-full" style={{width: `${conn.pct * 3}%`}}></div>
                                  </div>
                                  <span className="text-slate-500 font-mono w-8 text-right">{conn.pct}%</span>
                              </div>
                          ))}
                      </div>
                  </div>
                  <div>
                      <div className="text-[10px] text-blue-400 font-bold mb-2 uppercase">{game.opponent?.slice(0,3)}</div>
                      <div className="space-y-2">
                          {(analysis.intel?.assistDistribution?.opponent || [
                              { from: "Edwards", to: "Randle", pct: 16 },
                              { from: "Conley", to: "Edwards", pct: 14 },
                              { from: "Conley", to: "Gobert", pct: 11 }
                          ]).slice(0, 3).map((conn, i) => (
                              <div key={i} className="flex items-center gap-2 text-xs">
                                  <div className="flex-1 flex items-center gap-1">
                                      <span className="text-white font-medium truncate">{conn.from}</span>
                                      <span className="text-blue-400">→</span>
                                      <span className="text-slate-400 truncate">{conn.to}</span>
                                  </div>
                                  <div className="w-12 h-1.5 bg-cmd-border rounded-full overflow-hidden">
                                      <div className="h-full bg-blue-500 rounded-full" style={{width: `${conn.pct * 3}%`}}></div>
                                  </div>
                                  <span className="text-slate-500 font-mono w-8 text-right">{conn.pct}%</span>
                              </div>
                          ))}
                      </div>
                  </div>
              </div>
          </div>

          {/* Defense by Position */}
          <div className="glass-card p-4">
              <div className="flex items-center gap-2 mb-3"><Shield className="w-4 h-4 text-violet-400" /><span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Defense by Position (DRTG)</span></div>
              <div className="h-44">
                  <ResponsiveContainer width="100%" height="100%">
                      <RadarChart cx="50%" cy="50%" outerRadius="70%" data={[
                          { pos: 'PG', TOR: analysis.intel?.defenseByPosition?.raptors?.pg || 112.5, OPP: analysis.intel?.defenseByPosition?.opponent?.pg || 108.1 },
                          { pos: 'SG', TOR: analysis.intel?.defenseByPosition?.raptors?.sg || 108.2, OPP: analysis.intel?.defenseByPosition?.opponent?.sg || 110.5 },
                          { pos: 'SF', TOR: analysis.intel?.defenseByPosition?.raptors?.sf || 105.8, OPP: analysis.intel?.defenseByPosition?.opponent?.sf || 107.2 },
                          { pos: 'PF', TOR: analysis.intel?.defenseByPosition?.raptors?.pf || 110.3, OPP: analysis.intel?.defenseByPosition?.opponent?.pf || 106.8 },
                          { pos: 'C', TOR: analysis.intel?.defenseByPosition?.raptors?.c || 102.4, OPP: analysis.intel?.defenseByPosition?.opponent?.c || 99.5 }
                      ]}>
                          <PolarGrid stroke="#1e293b" />
                          <PolarAngleAxis dataKey="pos" tick={{ fill: '#94a3b8', fontSize: 10, fontWeight: 'bold' }} />
                          <PolarRadiusAxis angle={90} domain={[95, 120]} tick={false} axisLine={false} />
                          <Radar name="TOR" dataKey="TOR" stroke="#CE1141" fill="#CE1141" fillOpacity={0.3} strokeWidth={2} />
                          <Radar name="OPP" dataKey="OPP" stroke="#6366f1" fill="#6366f1" fillOpacity={0.2} strokeWidth={2} />
                          <Tooltip contentStyle={{ backgroundColor: '#111827', borderColor: '#1e293b', borderRadius: '8px', fontSize: '11px' }} />
                      </RadarChart>
                  </ResponsiveContainer>
              </div>
              <div className="flex justify-center gap-4 text-[10px] mt-1">
                  <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-raptors-red"></span> TOR (lower is better)</span>
                  <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-blue-500"></span> OPP</span>
              </div>
          </div>
      </div>

      {/* 6. ROTATION SIMULATOR */}
      <div className="glass-card overflow-hidden animate-slide-up" style={{animationDelay: '0.65s'}}>
          <div className="relative bg-gradient-to-r from-cmd-bg via-cmd-surface to-cmd-bg px-6 py-5 overflow-hidden">
              <div className="absolute inset-0 bg-grid opacity-20"></div>
              <div className="relative z-10 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                  <div>
                      <h2 className="text-2xl font-black text-white flex items-center gap-3 uppercase tracking-tight"><div className="bg-raptors-red p-2 rounded-lg shadow-lg shadow-raptors-red/30"><Activity className="w-5 h-5 text-white" /></div>Rotation Simulator</h2>
                      <p className="text-slate-500 text-xs mt-1 ml-12">Click a player on court, then click a bench player to swap</p>
                  </div>
                  <div className="flex items-center gap-3 ml-12 sm:ml-0">
                      <div className={`px-4 py-2 rounded-lg text-center ${(raptorsAgg.net - opponentAgg.net) >= 0 ? 'bg-green-500/10 border border-green-500/30' : 'bg-red-500/10 border border-red-500/30'}`}>
                          <div className={`text-xl font-black font-mono ${(raptorsAgg.net - opponentAgg.net) >= 0 ? 'text-green-400' : 'text-red-400'}`} style={(raptorsAgg.net - opponentAgg.net) >= 0 ? {textShadow: '0 0 10px rgba(74,222,128,0.3)'} : {textShadow: '0 0 10px rgba(248,113,113,0.3)'}}>{(raptorsAgg.net - opponentAgg.net) > 0 ? '+' : ''}{(raptorsAgg.net - opponentAgg.net).toFixed(1)}</div>
                          <div className="text-[9px] text-slate-500 uppercase font-bold tracking-wider">Edge</div>
                      </div>
                  </div>
              </div>
          </div>
          <div className="p-6 space-y-6">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                  <div className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Raptors Presets</div>
                  <div className="flex gap-1.5 bg-cmd-bg p-1 rounded-lg border border-cmd-border">
                       <button onClick={() => applyRaptorsPreset('starters')} className="btn-ripple flex-1 px-3 py-2 text-xs font-bold text-slate-300 hover:bg-cmd-card hover:text-white rounded transition-all flex items-center justify-center gap-1.5"><Users className="w-3 h-3" /> Starters</button>
                       <button onClick={() => applyRaptorsPreset('second')} className="btn-ripple flex-1 px-3 py-2 text-xs font-bold text-slate-300 hover:bg-cmd-card hover:text-white rounded transition-all flex items-center justify-center gap-1.5"><RefreshCcw className="w-3 h-3" /> 2nd Unit</button>
                       <button onClick={() => applyRaptorsPreset('speed')} className="btn-ripple flex-1 px-3 py-2 text-xs font-bold text-slate-300 hover:bg-cmd-card hover:text-white rounded transition-all flex items-center justify-center gap-1.5"><Zap className="w-3 h-3" /> Speed</button>
                       <button onClick={() => applyRaptorsPreset('big')} className="btn-ripple flex-1 px-3 py-2 text-xs font-bold text-slate-300 hover:bg-cmd-card hover:text-white rounded transition-all flex items-center justify-center gap-1.5"><Shield className="w-3 h-3" /> Big</button>
                  </div>
              </div>
              <div>
                  <div className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">{game.opponent} Presets</div>
                  <div className="flex gap-1.5 bg-cmd-bg p-1 rounded-lg border border-cmd-border">
                       <button onClick={() => applyPreset('starters')} className="btn-ripple flex-1 px-3 py-2 text-xs font-bold text-slate-300 hover:bg-cmd-card hover:text-white rounded transition-all flex items-center justify-center gap-1.5"><Users className="w-3 h-3" /> Starters</button>
                       <button onClick={() => applyPreset('second')} className="btn-ripple flex-1 px-3 py-2 text-xs font-bold text-slate-300 hover:bg-cmd-card hover:text-white rounded transition-all flex items-center justify-center gap-1.5"><RefreshCcw className="w-3 h-3" /> 2nd Unit</button>
                       <button onClick={() => applyPreset('speed')} className="btn-ripple flex-1 px-3 py-2 text-xs font-bold text-slate-300 hover:bg-cmd-card hover:text-white rounded transition-all flex items-center justify-center gap-1.5"><Zap className="w-3 h-3" /> Speed</button>
                  </div>
              </div>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 relative">
                <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-10 hidden md:block"><div className="bg-raptors-red p-2.5 rounded-full border-2 border-raptors-red/50 shadow-xl shadow-raptors-red/20 animate-glow-pulse"><Swords className="w-4 h-4 text-white" /></div></div>
                <div className="bg-gradient-to-br from-raptors-red/5 to-cmd-surface/50 rounded-xl p-4 border border-raptors-red/10">
                    <div className="flex justify-between items-end mb-4 pb-2 border-b-2 border-raptors-red/50">
                        <div className="flex items-center gap-2"><img src="https://cdn.nba.com/logos/nba/1610612761/primary/L/logo.svg" className="w-6 h-6" alt="TOR" /><h3 className="text-raptors-red font-black uppercase text-sm tracking-wider neon-text-subtle">TORONTO</h3></div>
                        <div className="flex items-center gap-3">
                            <div className="text-[10px] font-mono text-slate-500">ORTG <span className="font-bold text-white">{raptorsAgg.ortg.toFixed(1)}</span></div>
                            <div className="text-[10px] font-mono text-slate-500">DRTG <span className="font-bold text-white">{raptorsAgg.drtg.toFixed(1)}</span></div>
                            <div className={`text-xs font-mono font-bold px-2 py-0.5 rounded ${raptorsAgg.net >= 0 ? 'bg-green-500/10 text-green-400 border border-green-500/20' : 'bg-red-500/10 text-red-400 border border-red-500/20'}`}>NET {raptorsAgg.net > 0 ? '+' : ''}{raptorsAgg.net.toFixed(1)}</div>
                        </div>
                    </div>
                    <div className="grid grid-cols-5 gap-2">{activeRaptorsLineup.map((player, idx) => (<PlayerCard key={player.id} player={player} onClick={() => setSelectedSlot(selectedSlot?.team === 'raptors' && selectedSlot?.index === idx ? null : { team: 'raptors', index: idx })} onDeepDive={() => setSelectedPlayerForDeepDive(player)} isSelected={selectedSlot?.team === 'raptors' && selectedSlot?.index === idx} />))}</div>
                    <div className="mt-4 pt-3 border-t border-raptors-red/10">
                         <div className="flex items-center justify-between mb-2"><div className="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Bench ({raptorsBench.length})</div>{selectedSlot?.team === 'raptors' && <div className="text-[10px] font-bold text-raptors-red animate-pulse uppercase neon-text-subtle">Click to swap in</div>}</div>
                         <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">{raptorsBench.map(player => (<BenchCard key={player.id} player={player} onClick={() => handleBenchClick(player, 'raptors')} isHighlighted={selectedSlot?.team === 'raptors'} />))}</div>
                    </div>
                </div>
                <div className="bg-gradient-to-br from-blue-500/5 to-cmd-surface/50 rounded-xl p-4 border border-blue-500/10">
                    <div className="flex justify-between items-end mb-4 pb-2 border-b-2 border-blue-500/50">
                        <div className="flex items-center gap-2">{game.opponentId && <img src={`https://cdn.nba.com/logos/nba/${game.opponentId}/primary/L/logo.svg`} className="w-6 h-6" alt={game.opponent} />}<h3 className="text-blue-400 font-black uppercase text-sm tracking-wider">{game.opponent}</h3></div>
                        <div className="flex items-center gap-3">
                            <div className="text-[10px] font-mono text-slate-500">ORTG <span className="font-bold text-white">{opponentAgg.ortg.toFixed(1)}</span></div>
                            <div className="text-[10px] font-mono text-slate-500">DRTG <span className="font-bold text-white">{opponentAgg.drtg.toFixed(1)}</span></div>
                            <div className={`text-xs font-mono font-bold px-2 py-0.5 rounded ${opponentAgg.net >= 0 ? 'bg-green-500/10 text-green-400 border border-green-500/20' : 'bg-red-500/10 text-red-400 border border-red-500/20'}`}>NET {opponentAgg.net > 0 ? '+' : ''}{opponentAgg.net.toFixed(1)}</div>
                        </div>
                    </div>
                    <div className="grid grid-cols-5 gap-2">{activeOpponentLineup.map((player, idx) => (<PlayerCard key={player.id} player={player} onClick={() => setSelectedSlot(selectedSlot?.team === 'opponent' && selectedSlot?.index === idx ? null : { team: 'opponent', index: idx })} onDeepDive={() => setSelectedPlayerForDeepDive(player)} isOpponent isSelected={selectedSlot?.team === 'opponent' && selectedSlot?.index === idx} />))}</div>
                    <div className="mt-4 pt-3 border-t border-blue-500/10">
                         <div className="flex items-center justify-between mb-2"><div className="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Bench ({opponentBench.length})</div>{selectedSlot?.team === 'opponent' && <div className="text-[10px] font-bold text-blue-400 animate-pulse uppercase">Click to swap in</div>}</div>
                         <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">{opponentBench.map(player => (<BenchCard key={player.id} player={player} onClick={() => handleBenchClick(player, 'opponent')} isOpponent isHighlighted={selectedSlot?.team === 'opponent'} />))}</div>
                    </div>
                </div>
          </div>
          <div className="bg-cmd-bg/50 rounded-xl border border-cmd-border overflow-hidden">
              <div className="bg-cmd-surface/50 px-5 py-3 border-b border-cmd-border flex items-center gap-2"><BarChart3 className="w-4 h-4 text-slate-400" /><h3 className="text-sm font-bold text-slate-200 uppercase tracking-wider">Lineup Analytics Comparison</h3></div>
              <div className="p-5">
                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                      <div className="bg-cmd-surface/50 rounded-lg border border-cmd-border p-4">
                          <div className="text-xs font-bold text-slate-500 uppercase tracking-wider mb-3">Rating Comparison</div>
                          <div className="h-52">
                              <ResponsiveContainer width="100%" height="100%">
                                  <BarChart data={[
                                      { name: 'ORTG', Raptors: Number(raptorsAgg.ortg.toFixed(1)), Opponent: Number(opponentAgg.ortg.toFixed(1)) },
                                      { name: 'DRTG', Raptors: Number(raptorsAgg.drtg.toFixed(1)), Opponent: Number(opponentAgg.drtg.toFixed(1)) },
                                      { name: 'PER', Raptors: Number(raptorsAgg.per.toFixed(1)), Opponent: Number(opponentAgg.per.toFixed(1)) },
                                      { name: 'NET', Raptors: Number(raptorsAgg.net.toFixed(1)), Opponent: Number(opponentAgg.net.toFixed(1)) },
                                  ]} barGap={2} barCategoryGap="20%">
                                      <CartesianGrid strokeDasharray="3 3" stroke="#1e293b" />
                                      <XAxis dataKey="name" tick={{ fontSize: 11, fontWeight: 600, fill: '#94a3b8' }} />
                                      <YAxis tick={{ fontSize: 10, fill: '#64748b' }} domain={['auto', 'auto']} />
                                      <Tooltip contentStyle={{ backgroundColor: '#111827', borderColor: '#1e293b', borderRadius: '8px', boxShadow: '0 4px 20px rgba(206,17,65,0.15)', fontSize: '12px', color: '#e2e8f0' }} itemStyle={{ color: '#e2e8f0' }} />
                                      <Legend wrapperStyle={{ fontSize: '11px', fontWeight: 600, color: '#94a3b8' }} />
                                      <Bar dataKey="Raptors" fill="#CE1141" radius={[4, 4, 0, 0]} />
                                      <Bar dataKey="Opponent" fill="#6366f1" radius={[4, 4, 0, 0]} />
                                  </BarChart>
                              </ResponsiveContainer>
                          </div>
                      </div>
                      <div className="bg-cmd-surface/50 rounded-lg border border-cmd-border p-4">
                          <div className="text-xs font-bold text-slate-500 uppercase tracking-wider mb-3">Head-to-Head Breakdown</div>
                          <div className="space-y-3">
                              <ComparisonRow label="Offensive Rating" raptorsVal={raptorsAgg.ortg} opponentVal={opponentAgg.ortg} higherIsBetter={true} />
                              <ComparisonRow label="Defensive Rating" raptorsVal={raptorsAgg.drtg} opponentVal={opponentAgg.drtg} higherIsBetter={false} />
                              <ComparisonRow label="Net Rating" raptorsVal={raptorsAgg.net} opponentVal={opponentAgg.net} higherIsBetter={true} />
                              <ComparisonRow label="Avg PER" raptorsVal={raptorsAgg.per} opponentVal={opponentAgg.per} higherIsBetter={true} />
                              <ComparisonRow label="Combined PPG" raptorsVal={activeRaptorsLineup.reduce((s, p) => s + (p.seasonStats?.ppg || 0), 0)} opponentVal={activeOpponentLineup.reduce((s, p) => s + (p.seasonStats?.ppg || 0), 0)} higherIsBetter={true} />
                              <ComparisonRow label="Combined RPG" raptorsVal={activeRaptorsLineup.reduce((s, p) => s + (p.seasonStats?.rpg || 0), 0)} opponentVal={activeOpponentLineup.reduce((s, p) => s + (p.seasonStats?.rpg || 0), 0)} higherIsBetter={true} />
                              <ComparisonRow label="Combined APG" raptorsVal={activeRaptorsLineup.reduce((s, p) => s + (p.seasonStats?.apg || 0), 0)} opponentVal={activeOpponentLineup.reduce((s, p) => s + (p.seasonStats?.apg || 0), 0)} higherIsBetter={true} />
                          </div>
                      </div>
                  </div>
              </div>
          </div>
          </div>
      </div>

      {selectedPlayerForDeepDive && (<PlayerDeepDive player={selectedPlayerForDeepDive} opponentName={game.opponent} onClose={() => setSelectedPlayerForDeepDive(null)} />)}
    </div>
  );
};

// ============================================================
// Standings Widget
const StandingsWidget = ({ isDark = true }) => (
  <div className={`${isDark ? 'glass-card' : 'bg-white border border-light-border shadow-lg rounded-2xl'} overflow-hidden mt-4`}>
    <div className={`px-3 py-2 border-b ${isDark ? 'border-cmd-border' : 'border-light-border'} bg-gradient-to-r from-raptors-red/10 to-transparent`}>
      <h3 className={`text-xs font-bold ${isDark ? 'text-white' : 'text-slate-800'} flex items-center gap-2`}><Trophy className="w-3 h-3 text-yellow-500" /> East Standings</h3>
    </div>
    <div className={`divide-y ${isDark ? 'divide-cmd-border/50' : 'divide-light-border'} max-h-64 overflow-y-auto`}>
      {STANDINGS_EAST.map((team) => (
        <div key={team.abbr} className={`flex items-center justify-between px-3 py-1.5 text-xs ${team.highlight ? 'bg-raptors-red/10' : ''}`}>
          <div className="flex items-center gap-2">
            <span className="text-slate-500 w-4">{team.rank}</span>
            <img src={`https://cdn.nba.com/logos/nba/${team.id}/primary/L/logo.svg`} className="w-4 h-4" alt="" />
            <span className={team.highlight ? 'text-raptors-red font-bold' : isDark ? 'text-slate-300' : 'text-slate-700'}>{team.abbr}</span>
          </div>
          <span className={`font-mono ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>{team.wins}-{team.losses}</span>
        </div>
      ))}
    </div>
  </div>
);

// Theme Context
const ThemeContext = React.createContext({ isDark: true, toggle: () => {} });

// APP (ROOT)
// ============================================================
function App() {
  const [games, setGames] = useState([]);
  const [selectedGame, setSelectedGame] = useState(null);
  const [loadingSchedule, setLoadingSchedule] = useState(true);
  const [isDark, setIsDark] = useState(() => {
    if (typeof window !== 'undefined') {
      const saved = localStorage.getItem('raptors-intel-theme');
      return saved ? saved === 'dark' : true;
    }
    return true;
  });
  const [showReminder, setShowReminder] = useState(false);
  const [showShare, setShowShare] = useState(false);
  const [showKeyboardHelp, setShowKeyboardHelp] = useState(false);

  const toggleTheme = () => {
    setIsDark(prev => {
      const newVal = !prev;
      localStorage.setItem('raptors-intel-theme', newVal ? 'dark' : 'light');
      return newVal;
    });
  };

  // Keyboard shortcuts
  useEffect(() => {
    const handleKeydown = (e) => {
      if (e.key === '?' && !e.ctrlKey && !e.metaKey) {
        setShowKeyboardHelp(prev => !prev);
      }
      if (e.key === 'd' && !e.ctrlKey && !e.metaKey && e.target.tagName !== 'INPUT') {
        toggleTheme();
      }
      if (e.key === 'Escape') {
        setShowKeyboardHelp(false);
        setShowReminder(false);
        setShowShare(false);
      }
      if (e.key === 'ArrowDown' && e.target.tagName !== 'INPUT') {
        e.preventDefault();
        const idx = games.findIndex(g => g.id === selectedGame?.id);
        if (idx < games.length - 1) setSelectedGame(games[idx + 1]);
      }
      if (e.key === 'ArrowUp' && e.target.tagName !== 'INPUT') {
        e.preventDefault();
        const idx = games.findIndex(g => g.id === selectedGame?.id);
        if (idx > 0) setSelectedGame(games[idx - 1]);
      }
    };
    window.addEventListener('keydown', handleKeydown);
    return () => window.removeEventListener('keydown', handleKeydown);
  }, [games, selectedGame]);

  useEffect(() => {
    const init = async () => {
      const { games: fetchedGames } = await fetchRaptorsSchedule();
      setGames(fetchedGames);
      const nextGame = fetchedGames.find(g => g.status === 'upcoming');
      if (nextGame) setSelectedGame(nextGame);
      else if (fetchedGames.length > 0) setSelectedGame(fetchedGames[0]);
      setLoadingSchedule(false);
    };
    init();
  }, []);

  // Share function
  const handleShare = async (platform) => {
    const url = window.location.href;
    const text = selectedGame ? `Check out the Raptors vs ${selectedGame.opponent} scouting report on Raptors Intel! 🦖🏀` : 'Check out Raptors Intel - the ultimate game day scouting dashboard!';
    
    if (platform === 'copy') {
      await navigator.clipboard.writeText(url);
      alert('Link copied to clipboard!');
    } else if (platform === 'twitter') {
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
    } else if (platform === 'facebook') {
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
    }
    setShowShare(false);
  };

  // Set reminder
  const handleSetReminder = () => {
    if (selectedGame && selectedGame.status === 'upcoming') {
      const gameDate = new Date(selectedGame.date + ' 2026 ' + selectedGame.time);
      const reminderTime = new Date(gameDate.getTime() - 60 * 60 * 1000); // 1 hour before
      const calendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=Raptors vs ${selectedGame.opponent}&dates=${gameDate.toISOString().replace(/[-:]/g, '').split('.')[0]}Z/${new Date(gameDate.getTime() + 3*60*60*1000).toISOString().replace(/[-:]/g, '').split('.')[0]}Z&details=Game at ${selectedGame.venue}&location=${selectedGame.venue}`;
      window.open(calendarUrl, '_blank');
    }
    setShowReminder(false);
  };

  const themeClasses = isDark 
    ? 'bg-cmd-bg text-slate-200' 
    : 'bg-light-bg text-slate-800';
  
  const navClasses = isDark
    ? 'border-cmd-border bg-cmd-surface/90'
    : 'border-light-border bg-light-surface/90';

  return (
    <ThemeContext.Provider value={{ isDark, toggle: toggleTheme }}>
    <div className={`min-h-screen ${themeClasses} font-sans selection:bg-raptors-red selection:text-white flex flex-col h-screen overflow-hidden transition-colors duration-300`}>
      <nav className={`border-b ${navClasses} backdrop-blur-xl flex-shrink-0 z-30 relative`}>
        <div className="absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-raptors-red/50 to-transparent"></div>
        <div className="w-full max-w-[98%] mx-auto px-4 h-16 flex items-center justify-between">
          <div className="flex items-center gap-3">
             <div className={`w-10 h-10 ${isDark ? 'bg-cmd-bg' : 'bg-light-card'} rounded-full flex items-center justify-center p-1 border border-raptors-red/30 shadow-lg shadow-raptors-red/10 animate-glow-pulse`}>
               <img src="https://cdn.nba.com/logos/nba/1610612761/primary/L/logo.svg" alt="Raptors Logo" className="w-full h-full object-contain" />
             </div>
             <span className={`text-xl font-bold tracking-tight ${isDark ? 'text-white' : 'text-slate-800'}`}>RAPTORS <span className="text-raptors-red neon-text-subtle">INTEL</span></span>
          </div>
          <div className="flex items-center gap-4">
            <div className="hidden md:flex items-center gap-3">
              <div className="text-xs"><span className={isDark ? 'text-slate-500' : 'text-slate-500'}>Record:</span> <span className={`font-bold ${isDark ? 'text-white' : 'text-slate-800'}`}>{RAPTORS_STATS.wins}-{RAPTORS_STATS.losses}</span></div>
              <div className="text-xs"><span className={isDark ? 'text-slate-500' : 'text-slate-500'}>Streak:</span> <span className="font-bold text-green-500">{RAPTORS_STATS.streak}</span></div>
            </div>
            <div className="flex items-center gap-1">
              {/* Export Button */}
              <ExportButton game={selectedGame} isDark={isDark} />
              {/* Reminder Button */}
              <button onClick={() => setShowReminder(true)} className={`p-2 rounded-lg transition-all ${isDark ? 'hover:bg-cmd-card text-slate-400 hover:text-white' : 'hover:bg-light-card text-slate-500 hover:text-slate-800'}`} title="Set Reminder">
                <Bell className="w-4 h-4" />
              </button>
              {/* Share Button */}
              <button onClick={() => setShowShare(true)} className={`p-2 rounded-lg transition-all ${isDark ? 'hover:bg-cmd-card text-slate-400 hover:text-white' : 'hover:bg-light-card text-slate-500 hover:text-slate-800'}`} title="Share">
                <Share className="w-4 h-4" />
              </button>
              {/* Theme Toggle */}
              <button onClick={toggleTheme} className={`p-2 rounded-lg transition-all ${isDark ? 'hover:bg-cmd-card text-slate-400 hover:text-yellow-400' : 'hover:bg-light-card text-slate-500 hover:text-blue-600'}`} title={isDark ? 'Switch to Light Mode' : 'Switch to Dark Mode'}>
                {isDark ? <Sun className="w-4 h-4" /> : <Moon className="w-4 h-4" />}
              </button>
              {/* Keyboard Shortcuts */}
              <button onClick={() => setShowKeyboardHelp(true)} className={`p-2 rounded-lg transition-all hidden md:block ${isDark ? 'hover:bg-cmd-card text-slate-400 hover:text-white' : 'hover:bg-light-card text-slate-500 hover:text-slate-800'}`} title="Keyboard Shortcuts">
                <span className="text-xs font-mono">?</span>
              </button>
            </div>
          </div>
        </div>
      </nav>

      {/* Keyboard Shortcuts Modal */}
      {showKeyboardHelp && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm" onClick={() => setShowKeyboardHelp(false)}>
          <div className={`${isDark ? 'bg-cmd-surface border-cmd-border' : 'bg-white border-light-border'} border rounded-2xl p-6 max-w-sm w-full shadow-2xl`} onClick={e => e.stopPropagation()}>
            <h3 className={`text-lg font-bold ${isDark ? 'text-white' : 'text-slate-800'} mb-4 flex items-center gap-2`}>⌨️ Keyboard Shortcuts</h3>
            <div className="space-y-3 text-sm">
              <div className="flex justify-between"><span className={isDark ? 'text-slate-400' : 'text-slate-600'}>Toggle theme</span><kbd className={`px-2 py-1 rounded ${isDark ? 'bg-cmd-bg text-white' : 'bg-light-card text-slate-800'} font-mono text-xs`}>D</kbd></div>
              <div className="flex justify-between"><span className={isDark ? 'text-slate-400' : 'text-slate-600'}>Next game</span><kbd className={`px-2 py-1 rounded ${isDark ? 'bg-cmd-bg text-white' : 'bg-light-card text-slate-800'} font-mono text-xs`}>↓</kbd></div>
              <div className="flex justify-between"><span className={isDark ? 'text-slate-400' : 'text-slate-600'}>Previous game</span><kbd className={`px-2 py-1 rounded ${isDark ? 'bg-cmd-bg text-white' : 'bg-light-card text-slate-800'} font-mono text-xs`}>↑</kbd></div>
              <div className="flex justify-between"><span className={isDark ? 'text-slate-400' : 'text-slate-600'}>Close modals</span><kbd className={`px-2 py-1 rounded ${isDark ? 'bg-cmd-bg text-white' : 'bg-light-card text-slate-800'} font-mono text-xs`}>Esc</kbd></div>
              <div className="flex justify-between"><span className={isDark ? 'text-slate-400' : 'text-slate-600'}>Show shortcuts</span><kbd className={`px-2 py-1 rounded ${isDark ? 'bg-cmd-bg text-white' : 'bg-light-card text-slate-800'} font-mono text-xs`}>?</kbd></div>
            </div>
            <button onClick={() => setShowKeyboardHelp(false)} className="mt-4 w-full py-2 bg-raptors-red text-white rounded-lg font-bold hover:bg-raptors-red/90 transition-colors">Got it!</button>
          </div>
        </div>
      )}

      {/* Share Modal */}
      {showShare && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm" onClick={() => setShowShare(false)}>
          <div className={`${isDark ? 'bg-cmd-surface border-cmd-border' : 'bg-white border-light-border'} border rounded-2xl p-6 max-w-sm w-full shadow-2xl`} onClick={e => e.stopPropagation()}>
            <h3 className={`text-lg font-bold ${isDark ? 'text-white' : 'text-slate-800'} mb-4 flex items-center gap-2`}>📤 Share This Report</h3>
            <div className="grid grid-cols-3 gap-3">
              <button onClick={() => handleShare('twitter')} className={`p-4 rounded-xl ${isDark ? 'bg-cmd-bg hover:bg-cmd-card' : 'bg-light-card hover:bg-slate-200'} transition-colors flex flex-col items-center gap-2`}>
                <Twitter className="w-6 h-6 text-blue-400" />
                <span className="text-xs">Twitter</span>
              </button>
              <button onClick={() => handleShare('facebook')} className={`p-4 rounded-xl ${isDark ? 'bg-cmd-bg hover:bg-cmd-card' : 'bg-light-card hover:bg-slate-200'} transition-colors flex flex-col items-center gap-2`}>
                <Facebook className="w-6 h-6 text-blue-600" />
                <span className="text-xs">Facebook</span>
              </button>
              <button onClick={() => handleShare('copy')} className={`p-4 rounded-xl ${isDark ? 'bg-cmd-bg hover:bg-cmd-card' : 'bg-light-card hover:bg-slate-200'} transition-colors flex flex-col items-center gap-2`}>
                <Copy className="w-6 h-6 text-slate-400" />
                <span className="text-xs">Copy Link</span>
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Live Score Ticker */}
      <LiveScoreTicker isDark={isDark} />

      {/* Reminder Modal */}
      {showReminder && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm" onClick={() => setShowReminder(false)}>
          <div className={`${isDark ? 'bg-cmd-surface border-cmd-border' : 'bg-white border-light-border'} border rounded-2xl p-6 max-w-sm w-full shadow-2xl`} onClick={e => e.stopPropagation()}>
            <h3 className={`text-lg font-bold ${isDark ? 'text-white' : 'text-slate-800'} mb-4 flex items-center gap-2`}>🔔 Set Game Reminder</h3>
            {selectedGame?.status === 'upcoming' ? (
              <>
                <p className={`text-sm ${isDark ? 'text-slate-400' : 'text-slate-600'} mb-4`}>
                  Add <strong>Raptors vs {selectedGame.opponent}</strong> on <strong>{selectedGame.date}</strong> to your calendar?
                </p>
                <button onClick={handleSetReminder} className="w-full py-3 bg-raptors-red text-white rounded-lg font-bold hover:bg-raptors-red/90 transition-colors flex items-center justify-center gap-2">
                  <Calendar className="w-4 h-4" /> Add to Google Calendar
                </button>
              </>
            ) : (
              <p className={`text-sm ${isDark ? 'text-slate-400' : 'text-slate-600'}`}>Select an upcoming game to set a reminder.</p>
            )}
          </div>
        </div>
      )}
      <main className="flex-1 overflow-hidden w-full max-w-[98%] mx-auto px-4 py-4">
        <div className="grid grid-cols-12 gap-4 h-full">
          <div className="col-span-12 lg:col-span-2 h-full overflow-y-auto space-y-4 pb-4">
            <QuickStatsBar isDark={isDark} />
            <StreakCelebration streak={RAPTORS_STATS.streak} isDark={isDark} />
            <GameCountdown game={selectedGame} isDark={isDark} />
            <ScheduleList games={games} onSelectGame={setSelectedGame} selectedGameId={selectedGame?.id} isDark={isDark} />
            <StandingsWidget isDark={isDark} />
            {selectedGame?.status === 'upcoming' && <BettingTrendsWidget isDark={isDark} game={selectedGame} />}
          </div>
          <div className="col-span-12 lg:col-span-10 h-full overflow-y-auto custom-scrollbar pb-10">
            {loadingSchedule ? (
              <div className={`h-full flex flex-col items-center justify-center ${isDark ? 'glass-card' : 'bg-white border border-light-border rounded-2xl shadow-lg'}`}>
                <div className="relative w-10 h-10 mb-4"><div className="absolute inset-0 rounded-full border-4 border-raptors-red/20"></div><div className="absolute inset-0 rounded-full border-4 border-raptors-red border-t-transparent animate-spin"></div></div>
                <p className={`font-medium ${isDark ? 'text-slate-400' : 'text-slate-600'}`}>Loading Season Data...</p>
              </div>
            ) : selectedGame ? (
              <MatchupAnalyzer game={selectedGame} isDark={isDark} />
            ) : (
              <div className={`h-full flex flex-col items-center justify-center ${isDark ? 'glass-card text-slate-500' : 'bg-white border border-light-border rounded-2xl shadow-lg text-slate-400'}`}><LayoutDashboard className="w-12 h-12 mb-4 opacity-30" /><p>Select a game from the calendar to open the scouting report.</p></div>
            )}
          </div>
        </div>
      </main>
      <footer className={`flex-shrink-0 border-t ${isDark ? 'border-cmd-border bg-cmd-surface/50' : 'border-light-border bg-white/50'} backdrop-blur py-3`}>
        <div className="w-full max-w-[98%] mx-auto px-4 flex items-center justify-between text-xs text-slate-500">
          <div className="flex items-center gap-2">
            <span className="font-bold text-raptors-red">RAPTORS INTEL</span>
            <span className={isDark ? 'text-slate-600' : 'text-slate-400'}>v5.6</span>
          </div>
          <div className="hidden md:flex items-center gap-4">
            <span>Built for Raptors fans 🦖</span>
            <span className={isDark ? 'text-slate-600' : 'text-slate-400'}>|</span>
            <span>Not affiliated with the NBA or Toronto Raptors</span>
          </div>
          <div className="flex items-center gap-2">
            <span className={`text-[10px] ${isDark ? 'text-slate-600' : 'text-slate-400'}`}>Press <kbd className={`px-1 py-0.5 rounded ${isDark ? 'bg-cmd-bg' : 'bg-light-card'} font-mono`}>?</kbd> for shortcuts</span>
          </div>
        </div>
      </footer>
    </div>
    </ThemeContext.Provider>
  );
}

// ============================================================
// RENDER
// ============================================================
const rootElement = document.getElementById('root');
const root = ReactDOM.createRoot(rootElement);
root.render(<App />);
    </script>
  </body>
</html>
